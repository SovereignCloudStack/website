---
layout: post
title: "Let's put the cloud in a box #2"
image: "blog/ciab.jpg"
author:
  - "Kurt Garloff"
avatar:
  - "kgarloff.jpg"
about:
  - "garloff"
---

**This blog post is part of a multi-series publication. Read more about how to initially set up the cloud-in-a-box system in the first part of this blog post: [Let's put the cloud in a box]({% post_url blog/2023-03-15-ciab %})**  

## Usage of the system

There are a number of web interfaces available for exploration of your cloud;
they are listed in the [documentation](https://github.com/osism/cloud-in-a-box/blob/main/README.md)
of the cloud-in-a-box on the OSISM repo on github. If you just want to bookmark one page, you should
use the [Homer dashboard](https://homer.services.in-a-box.cloud/) which has links to all the other
web interfaces.

<figure class="figure mx-auto d-block" style="width:100%">
  <a href="{% asset "blog/ciab-homer.png" @path %}" alt="Homer Screenshot">
    {% asset 'blog/ciab-homer.png' class="figure-img w-100" %}
  </a>
</figure>

The cloud comes preconfigured with a `test` project the smaller half of the standard SCS flavors,
a CirrOS and an Ubuntu image. It also has a public network created that allows created VMs
to talk to the network that your CiaB host is connected to (and to the internet if outgoing
connections to the internet are available on the CiaB host) and allocate floating IPs from.
The OpenStack core service are deployed as well as Octavia and Designate.

## OpenStack API / command line access

The documentation describes the easiest way to access use the command line interface:
When you connect to the Cloud-in-a-Box manager system via SSH, you can use the container there
with the installed OpenStack CLI tools and the configuration is already done
for you. Just `export OS_CLOUD=test` or `export OS_CLOUD=admin` to access the
OpenStack API with normal user or admin privileges respectively via the
command line interface tool `openstack`.

You can also do it from the wireguard-connected client directly. Install the
`python3-openstackclient` client tools there (from your distribution or via `pip`)
and configure the cloud in your `~/.config/openstack/clouds.yaml` and `secure.yaml`.

You can do by copying over `clouds.yml` and `secure.yml` from `/opt/configuration/environments/openstack/`
on the CiaB manager and also `/etc/ssl/certs/ca-certificates.crt` to avoid
SSL errors. You can move the latter into a directory that you have write access
to and adjust the references in `clouds.yaml`. You may drop the `octavia` and `system`
entries from `clouds.yaml` and `secure.yaml` and you also might rename the two remaining
entries in `ciab-admin` and `ciab-test` to avoid creating naming conflicts with other
entries that you may already have in your collection of clouds.

Here is how it look like on my system:
* `clouds.yaml`:
```yaml
clouds:
  ciab-admin:
    auth:
      project_name: admin
      auth_url: https://api.in-a-box.cloud:5000/v3
      project_domain_name: default
      user_domain_name: default
    cacert: ~/.config/openstack/ciab-certificates.crt
    identity_api_version: 3
  ciab-test:
    auth:
      project_name: test
      auth_url: https://api.in-a-box.cloud:5000/v3
      project_domain_name: default
      user_domain_name: default
    cacert: ~/.config/openstack/ciab-certificates.crt
    identity_api_version: 3
```
* `secure.yaml`:
```yaml
  ciab-admin:
    auth:
      username: "admin"
      password: "password"
  ciab-test:
    auth:
      username: "test"
      password: "test"
```
with `ciab-certificates.crt` in the same directory copied over from the
CiaB manager host's `/etc/ssl/certs/ca-certificates.crt`.

You can of course also use Terraform and other Infrastructure-as-Code tools
with these credentials.

## So what to use this for?

You can do what you could what you would do with access to a SCS IaaS system.
Like e.g. starting VMs and running workloads. Deploying cluster-api-provider to run
your own Kubernetes clusters. Use openstack-health-monitor to monitor performance and availability
of your system, running compliance checks etc.

It is thus a really useful demo system. Be aware however that with preconfigured
documented passwords, this system is easy prey for any hacker when connected to
the internet.

In addition you have OpenStack admin access. So you can do things like creating flavors,
register public images, or look at the hypervisor(s).

On the management host, you can maintain the system. You analyze log files or you
update the kolla containers.

You can also access the Docker containers to test changes. Obviously, if you do this,
you have created a state that is no longer clean from a manager perspective; in the
best case, the next container refresh will undo your custom changes. In the worst case,
you'll manage to cause serious breakage.

Here are some things we have used the Cloud-in-a-Box system for:
* We reproduced the [VMDK security issue](https://scs.community/security/2023/01/24/cve-2022-47951/),
  without having to test exploits against the production systems of our partners.
  After reproducing and then validating that the fixed containers address the issue,
  we tested against the fixed production systems though in close collaboration with our partners to
  double check that the fix also works in the production environments.
* Doing a PoC for handling flavor name aliases when these evolve, see
  https://github.com/SovereignCloudStack/standards/issues/228
* Analyzing how we can possibly contribute a patch that resolves the OVN loadbalancer's
  health monitor only rerouting the traffic away from failed hosts via the internal VIP
  address but not the public FIP address (add link). No result yet though.
  See https://bugs.launchpad.net/neutron/+bug/1956035.
