---
layout: post
title:  "Sovereign Cloud Stack Security Advisory OvS proto 0 DoS (CVE-2023-1668)"
category: security
author:
  - "Christian Berendt"
  - "Kurt Garloff"
  - "Felix Kronlage-Dammers"
avatar:
  - "CB.png"
  - "kgarloff.jpg"
  - "fkr.jpg"
about:
  - "garloff"
  - "fkr"
---

## The vulnerability

David Marchand (RedHat) reported a an issue with Open vSwitch (OvS) where
the failure to properly execute 'set' actions for specifically crafted
network packets with IP protocol number 0 could lead to a succesful remote
Denial-of-Service (DoS) attack.

<!-- @berendt: It was mentioned that Jens Harbott was involved in finding and/or
 analyzing this. I have no information -- if he deserves credit, we should of
 course give it. -->

The vulnerability is long-standing and affects Open vSwitch going back until
at least 1.5.0. (Current is 3.1.1, which has this issue fixed.)

The vulnerability has been assigned [CVE-2023-1668](https://cve.report/CVE-2023-1668),
a more detailed description can be found in the 
[Openwall OSS security advisory](https://www.openwall.com/lists/oss-security/2023/04/06/1). 

## Impact on the SCS reference implementation

Open vSwitch is used in almost all OpenStack setups -- specifically all SCS
setups known to us use OvS. This includes both the OVN configurations
(the SCS default) as well as those that rely on OvS alone.

## Mitigation

It is possible to set flow rules that block IP protocol 0 packets by adding
3 flow rules as highest priority rules to ever OvS bridge. Care is needed to
ensure this happens automatically on every single bridge, which is a non-trivial
endeavor.

There are patches available to fix the issue. These patches are included in the
current OvS version 3.1.1. They have also been backported into older versions
3.0.4, 2.17.6, 2.16.7, 2.15.8, 2.14.9, 2.13.11.

## SCS releases

Due to ongoing work on improving the network stack, [OSISM](https://osism.tech/)
had released a version [5.1.0](http://release.osism.tech/notes/5.1.0.html) on Apr 7,
which includes the OvS version 3.1.1 that includes the fix. Due to the networking
improvements, the SCS project had advised all SCS partners to move from 4.x.0 
(SCS Release 3) or from 5.0.0 (SCS Release 4) to 5.1.0 even without being aware
of CVE-2023-1668.

SCS release 3 (OSISM 4.x.y) is only officially supported until the end of April
2023 -- we advise all our partners to move to R5 with OSISM 5.1.0 or later as
soon as possible.

OSISM has worked on preparing a version 4.3.0 that includes a patched OvS version
for those partners that can not yet move to R4/OSISM-5.x. as of today (2023-04-21),
it has not been released yet -- please get in touch with OSISM if you have an
urgent need for it.

## Patch status of SCS clouds

The networking improvements for OSISM 5.1.0 were done in close alignement between
PlusServer and OSISM -- consequently, all regions of the 
[PlusCloud Open](https://www.plusserver.com/en/products/pluscloud-open)
had been upgraded to OSISM-5.1.0 in calendar week 15 already.

[Betacloud](https://betacloud.de/) - is it currently operational?
[WaveStack](https://www.noris.de/wavestack-cloud/) - still on OSISM 4.x as of Fri morning
[regio tech](https://regio.digital/) - On 5.x, exact status to be confirmed

<!-- Do we want to cover AOV and others here? -->

## Thanks

The authors would like to thank the RedHat engineer who reported the vulnerability,
the upstream OvS community and Jens Harbott at OSISM for working on addressing
the issue.

## Version history

* Initial Draft, v0.9, 2023-04-21, 08:30 CEST.

