<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  

  <title>SCS Security Advisory on incomplete QCOW2 and VMDK image handling protections (CVE-2024-40767) | Sovereign Cloud Stack</title>
  <meta property="og:title" content="SCS Security Advisory on incomplete QCOW2 and VMDK image handling protections (CVE-2024-40767) | Sovereign Cloud Stack">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:locale" content="de" />
<meta name="description" content="The vulnerability" />
<meta property="og:description" content="The vulnerability" />
<link rel="canonical" href="https://scs.community/security/2024/07/23/cve-2024-40767/" />
<meta property="og:url" content="https://scs.community/security/2024/07/23/cve-2024-40767/" />
<meta property="og:site_name" content="Sovereign Cloud Stack" />
<meta property="og:image" content="https://scs.community/assets/images/default-card-d32fdb798ca15ae927f00593ce64407f69c70d4011955dc94c7be76b99c474f4e673ee1a26ec53725dda80c2c331e5ad4300a43e702171cc014cd47ec6b2f94d.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://scs.community/assets/images/default-card-d32fdb798ca15ae927f00593ce64407f69c70d4011955dc94c7be76b99c474f4e673ee1a26ec53725dda80c2c331e5ad4300a43e702171cc014cd47ec6b2f94d.jpg" />
<meta property="twitter:title" content="SCS Security Advisory on incomplete QCOW2 and VMDK image handling protections (CVE-2024-40767)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-15T05:25:24+00:00","datePublished":"2024-07-23T00:00:00+00:00","description":"The vulnerability","headline":"SCS Security Advisory on incomplete QCOW2 and VMDK image handling protections (CVE-2024-40767)","image":"default-card.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://scs.community/security/2024/07/23/cve-2024-40767/"},"url":"https://scs.community/security/2024/07/23/cve-2024-40767/"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://scs.community/feed.xml" title="Sovereign Cloud Stack" />


  <!-- Matomo -->
  <script>
    if (typeof(Storage) !== 'undefined') {
    	if (localStorage.getItem('matomoTrackingEnabled') === null) {
    		localStorage.setItem('matomoTrackingEnabled', 'true');
    	}
    }
  </script>
  <script>
    if (localStorage.getItem('matomoTrackingEnabled') !== 'false') {
      var _paq = window._paq = window._paq || [];
      _paq.push(['disableCookies']);
      _paq.push(["setDoNotTrack", true]);
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://matomo.scs.community/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    }
  </script>
  <!-- End Matomo Code -->

  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="/assets/vendor/jquery/jquery-a0b8b972af0e63f0a8ff91994568d150c0e76de30c09ae1ed8405692fa313fa0d534458612a8a71e9a7e4dced5349cff481fbd863e19b98b6d41fb4881cd62be.js" integrity="sha512-oLi5cq8OY/Co/5GZRWjRUMDnbeMMCa4e2EBWkvoxP6DVNEWGEqinHpp+Tc7VNJz/SB+9hj4ZuYttQftIgc1ivg==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/vendor/bootstrap/js/bootstrap.bundle-d8e114e4e623acf24bb3c3cbf6a906fbd37e0db1c1aaf5a3123954efaae74ad62f651ce863c9368b9fed706d608f0fe3c281a1b989179b4d917377fa1c653eb7.js" integrity="sha512-2OEU5OYjrPJLs8PL9qkG+9N+DbHBqvWjEjlU76rnStYvZRzoY8k2i5/tcG1gjw/jwoGhuYkXm02Rc3f6HGU+tw==" crossorigin="anonymous"></script>
  <!-- Lighbox -->
  <script type="text/javascript" src="/assets/vendor/lightbox-02cc852cceea74c2b61add6b54cff8c2c48278e3da09b13c2aa41b4abb82a5ecfe3ad53fe5f12da728c0b5990f06a2a3a5fe9c9c2ebdef40d93421cac0b267cc.js" integrity="sha512-AsyFLM7qdMK2Gt1rVM/4wsSCeOPaCbE8KqQbSruCpez+OtU/5fEtpyjAtZkPBqKjpf6cnC6970DZNCHKwLJnzA==" crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="/assets/css/lightbox-0184be351f33358fce8415b3f8bdda50e58ee86ff1de0b37d00a26f602e14fc61896ad0bb90662299dea49767123bfe2c724163867b097f5f92cc1785e324cad.css" integrity="sha512-AYS+NR8zNY/OhBWz+L3aUOWO6G/x3gs30Aom9gLhT8YYlq0LuQZiKZ3qSXZxI7/ixyQWOGewl/X5LMF4XjJMrQ==" crossorigin="anonymous">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="/assets/css/main-b8cf68a63f9b26ea819f67d4e3a173489daf6c6c7de17051d360d8e72b41c67279d732bd19f4a04210326db8595205b80d704f640296bb5f5f63bedc042df118.css" integrity="sha512-uM9opj+bJuqBn2fU46FzSJ2vbGx94XBR02DY5ytBxnJ51zK9GfSgQhAybbhZUgW4DXBPZAKWu19fY77cBC3xGA==" crossorigin="anonymous">
  <!-- Pygments CSS -->
  <link rel="stylesheet" type="text/css" href="/assets/css/pygments-css/zenburn-b9247179f996de88844d73acaa60564a48db30aa0fec022f80b7641b41d45140625b657433da3bd722f68ba2fed77bfaa94972b9eed09c77a427e04a1707917e.css" integrity="sha512-uSRxefmW3oiETXOsqmBWSkjbMKoP7AIvgLdkG0HUUUBiW2V0M9o71yL2i6L+13v6qUlyue7QnHekJ+BKFweRfg==" crossorigin="anonymous">
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-50d41dce7bb6498cab01cffd5f46e59a664056fd725ecf84d9c8e5ad9ac8ca1470a0b82fe79789d09136c4a7999658948394d89d9764e4174dfeec26fa7636ae.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32-c5b260bd36bab2cb0496cec647907efc38ca4ac5cb5c978603405fe682da762b16d3b21e997fc85c1c76db4e4bae08787a9a9cbfeb38c7b796ea6de38011953b.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16-01a7499e8495e00e13117aca0a759d19faeca0c8fe23c003bf5aabef7b7b5abbbb1ad3d149d0630d9997f941fb53e13d85a950be0104d76283df37fbaba34717.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="mask-icon" color="#50c3a5" href="/assets/images/safari-pinned-tab-3194c271a2bc561b5707fb2998d39947f8feeabebcc64dfb41004e04f7ae120a6ae7157839c91b2b6f0920545a23959142d86e565ba6250800bafb99a2237583.svg" />
  <meta name="msapplication-config" content="/browserconfig.xml" />
  <meta name="msapplication-TileColor" content="#50c3a5">
  <meta name="theme-color" content="#ffffff">
</head>


<body class="d-flex flex-column min-vh-100">
  <!-- Navigation -->
<nav class="navbar navbar-dark bg-gold sticky-top" style="height: 55px;">
  <div class="container d-flex justify-content-center">
	  <a class="lh-1 fw-bolder link-unstyled text-center stretched-link" href="https://sovereigncloudstack.org/">Entdecke unsere neue Webseite</a>
  </div>
</nav>
<nav class="navbar navbar-expand-lg navbar-light sticky-top bg-light">
  <div class="container align-items-start">
    <div class="d-lg-flex flex-row flex-fill align-items-end">
      <button
        class="navbar-toggler me-auto"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto">
          
          <li class="nav-item">
            
              <a class="nav-link" href="/de/">
                Home
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                SCS entdecken
              </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  
                    <li><a class="dropdown-item" href="/de/about/">Ãœber SCS</a></li>
                  
                    <li><a class="dropdown-item" href="/de/use/">SCS nutzen</a></li>
                  
                    <li><a class="dropdown-item" href="/de/contribute/">Zu SCS beitragen</a></li>
                  
                    <li><a class="dropdown-item" href="/de/partners/">Servicepartner</a></li>
                  
                    <li><a class="dropdown-item" href="/de/members/">Community Members</a></li>
                  
              </ul>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/de/news/">
                Neuigkeiten
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/de/events/">
                Veranstaltungen
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/de/jobs/">
                Offene Stellen
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/de/tenders/">
                Ausschreibungen
              </a>
            
          
          </li>
          <li><a class="nav-link" href="https://docs.scs.community">Dokumentation</a></li>
        </ul>
        <ul class="navbar-nav flex-row align-content-end">
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://social.osb-alliance.de/@SCS">
              <i class="fa fa-mastodon fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://www.linkedin.com/company/sovereigncloudstack">
              <i class="fa fa-linkedin-square fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://www.youtube.com/@sovereigncloudstack">
              <i class="fa fa-youtube-square fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://github.com/SovereignCloudStack">
              <i class="fa fa-github fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org">
              <i class="fa fa-matrix-org fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://scs.sovereignit.de/mailman3/postorius/lists/announce.lists.scs.community/">
              <i class="fa fa-bullhorn"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="/feed.xml">
              <i class="fa fa-rss"></i>
            </a>
          </li>
          
        </ul>
      </div>
      <div class="d-none d-lg-block">
        <ul class="navbar-nav flex-row">
  <li class="nav-item my-auto ms-4 ms-lg-2">
    <a class="nav-link fw-bold  " href="/security/2024/07/23/cve-2024-40767/">EN</a>
  </li>
  <li class="nav-item my-auto mx-2 mx-lg-0">
    <span class="nav-link px-0">/</span>
  </li>
  <li clas="nav-item my-auto">
    <a class="nav-link fw-bold   text-decoration-underline " href="/de/security/2024/07/23/cve-2024-40767/">DE</a>
  </li>
</ul>
      </div>
    </div>
    <div class="d-lg-none">
      <ul class="navbar-nav flex-row">
  <li class="nav-item my-auto ms-4 ms-lg-2">
    <a class="nav-link fw-bold  " href="/security/2024/07/23/cve-2024-40767/">EN</a>
  </li>
  <li class="nav-item my-auto mx-2 mx-lg-0">
    <span class="nav-link px-0">/</span>
  </li>
  <li clas="nav-item my-auto">
    <a class="nav-link fw-bold   text-decoration-underline " href="/de/security/2024/07/23/cve-2024-40767/">DE</a>
  </li>
</ul>
    </div>
  </div>
</nav>
 <!-- Header -->
<header class="bg-white py-2 mb-2">
  <div class="container h-100">
    <div class="row h-100 align-items-center">
      <div class="col-lg-6 pe-lg-4">
        <div class="mt-5 mb-3">
          <img alt="Sovereign Cloud Stack" width="50%" class="img-fluid" src="/assets/images/SCS_horizontal-749ea34c9192a57edc36f112b92ac2eddb847d3e47643f37488b3d148c9b98a720215c0c8e17ad0d3837c9056ae6feae3cdc931ed36e911b2b1b61a20b417de6.svg" integrity="sha512-dJ6jTJGSpX7cNvESuSrC7duEfT5HZD83SIs9FIybmKcgIVwMjhetDTg3yQVq5v6uPNyTHtNukRsrG2GiC0F95g==" crossorigin="anonymous">
        </div>
        <p class="lead text-black-50 mb-lg-3">
          Eine Plattform â€” standardisiert, entwickelt und betrieben von Vielen.
        </p>
      </div>
      <div class="col-lg-6 text-lg-end text-nowrap my-auto">
        <a href="https://osb-alliance.com" target="_blank" class="text-decoration-none">
          <img alt="Open Source Business Alliance" width="25%" class="img-fluid" src="/assets/images/logo-osba-615e489a04d99f1ead83a6fa64d76dfc96d1f6a8448ee5457099e2bc8fddb235379f6607e917a0fcfb519ff1902ac5596213d7339ef9f48a0925aaf2b1221ee0.svg" integrity="sha512-YV5ImgTZnx6tg6b6ZNdt/JbR9qhEjuVFcJnivI/dsjU3n2YH6Reg/PtRn/GQKsVZYhPXM5759IoJJarysSIe4A==" crossorigin="anonymous">
        </a>
        <a href="https://bmwk.de" target="_blank" class="text-decoration-none">
          <img alt="Bundesministerium fÃ¼r Wirtschaft und Klimaschutz" width="25%" class="img-fluid ms-5" src="/assets/images/logo-bmwk-funded-a4b929201f73ab45853836459b686db98f0b2e37189400588ce992a51c6c59d371835e93cd0d5b891f05fce75d6b87383c3fc12d52c6d560c5602eb32bf58b90.svg" integrity="sha512-pLkpIB9zq0WFODZFm2htuY8LLjcYlABYjOmSpRxsWdNxg16TzQ1biR8F/Odda4c4PD/BLVLG1WDFYC6zK/WLkA==" crossorigin="anonymous">
        </a>
        <a href="https://gaia-x.eu" target="_blank" class="text-decoration-none">
          <img alt="Gaia-X" width="30%" class="img-fluid ms-3" src="/assets/images/logo-gaiax-fbfa0132aaba3946d970e942fd98ef403abb12f8f344cc3087fcb466e23424b0d7dddd9b8b2ce4979df58e4b78e48f0419eb721e0f0599bd89df6b46c2871c43.svg" integrity="sha512-+/oBMqq6OUbZcOlC/ZjvQDq7EvjzRMwwh/y0ZuI0JLDX3d2biyzkl531jkt45I8EGetyHg8Fmb2J32tGwoccQw==" crossorigin="anonymous">
        </a>
      </div>
    </div>
  </div>
</header>

  <!-- Page Content -->
  <div class="container mb-5">
    
<div class="d-flex w-100 flex-column mb-3">
	<h1 class="pb-1 mb-0"><small>SCS Security Advisory on incomplete QCOW2 and VMDK image handling protections (CVE-2024-40767)</small></h1>
	<div class="d-flex w-100 flex-row">
		<div style="max-width: 80px; max-height: 80px;" class="rounded-3 overflow-hidden ratio ratio-1x1">
			<div style="max-width: 80px; max-height: 80px;" class="overflow-hidden ratio ratio-1x1">

  
  
  <svg height="80" width="80">
    <mask id="0be169ad2e3a">
      <circle cx="40" cy="40" r="40" fill="white"/>
      <rect x="40" y="0" width="40" height="80" fill="black" stroke="black" stroke-width="2"/>
    </mask>
    <mask id="27f3c2c45182">
      <circle cx="40" cy="40" r="40" fill="white"/>
      <rect x="0" y="0" width="40" height="80" fill="black" stroke="black" stroke-width="2"/>
    </mask>
    <image x="-20" y="0" height="80" width="80" xlink:href="/assets/79e5ad-9f8be8cc33736f60cef97b709a096937121338e312e9e3ee13933b9a583c30435edcd60f7154a6d23891a4c62230e2f40cdbe49f20b0da944423849e9f37c883.webp" mask="url(#0be169ad2e3a)"></image>
    <image x="20" y="0" height="80" width="80" xlink:href="/assets/bec745-d78ad0118f9991304e777e3abcfd8df1bdbf73d3c957d75c1665c691727bbe4fcf980ad96de7dbdc01121570ccba2f95ff54a0506980b254274a92139284d4de.webp" mask="url(#27f3c2c45182)"></image>
  </svg>

</div>

		</div>
		<div class="d-flex w-100 flex-column ms-3 my-auto">
			<small class="mb-1 fw-bolder">Kurt Garloff, Christian Berendt</small>
			<small>
	23.
	
	Juli
	  
	2024

</small>
		</div>
	</div>
</div>

<h2 id="the-vulnerability">The vulnerability</h2>

<p>OpenStack supports users to upload custom VM images in a number of formats
to be used for creating Virtual Machines. The simplest is a raw copy of a harddisk,
while other formats such as QCOW2 and VMDK are more advanced in being compressed
and allowing for embedding additional information. They also support referencing
other files. The latter feature needs to be controlled by OpenStack to avoid
exposing sensitive files. OpenStack thus disallows such external references
for customer images. The protections were found to be incomplete before which
lead to 
<a href="https://scs.community/de/security/2023/01/24/cve-2022-47951/">CVE-2022-47951</a>
and
<a href="https://scs.community/de/security/2024/07/02/cve-2024-32498/">CVE-2024-32498</a>.</p>

<p>Unfortunately, the last fixes with CVE-2024-32498 still were incomplete:
Arnaud Morin (OVH) reported a vulnerability in Nova. By supplying a raw format
image which is actually a specially crafted QCOW2 image with a backing file
path or VMDK flat image with a descriptor file path, an authenticated user may
convince systems to return a copy of the referenced fileâ€™s contents from the
server resulting in unauthorized access to potentially sensitive data. All Nova
deployments are affected.</p>

<p>The vulnerability has been assigned <a href="https://cve.report/CVE-2024-40767">CVE-2024-40767</a>.</p>

<h2 id="impact-on-the-scs-reference-implementation">Impact on the SCS reference implementation</h2>

<p>The <a href="https://scs.community/">Sovereign Cloud Stack</a> reference implementation
(by <a href="https://osism.tech/">OSISM</a>) runs these services in containers and thus
most files from the hypervisorâ€™s file system are not directly accessible from
inside the container via this vulnerability. However, this depends on the
service inside the container. Some services have access to data from the
hypervisor or they contain sensitive data themselves (e.g. credentials to
connect to other services), and thus they are accessible by a potential
attacker. They have also access to log files from the services which may
expose sensitive data.</p>

<p><em>To abuse this vulnerability, the attacker must be an authenticated
user of the platform.</em></p>

<p>We were <em>not</em> able to exploit this vulnerability in systems that included
the hotfix patches for 
<a href="https://scs.community/de/security/2024/07/02/cve-2024-32498/">CVE-2024-32498</a>
in our testing.
Nova did treat the VMDK and QCOW images declared as raw as raw (as did
Cinder, but Cinder is not suspected of mistreating them).
Boot disks created by Nova from the crafted VMDK and QCOW2 images contain
the raw contents of the images, without their external references being
resolved and thus without exposing any external content.
This is probably caused by SCS <em>not</em> changing the default to
<code class="language-plaintext highlighter-rouge">use_cow_images=False</code>. We currently are not aware of working exploits
without that (non-default) setting.</p>

<p>We would argue that mislabeled images should better be rejected early, as
the investigation chain may otherwise be confused which has the potential
to cause exploitable vulnerabilities. So we still highly recommend to patch
the weakness soon.</p>

<p>Operators that are using <code class="language-plaintext highlighter-rouge">use_cow_images=False</code> in their nova config are
advised to apply the fixes urgently.</p>

<h2 id="embargo">Embargo</h2>

<p>The issue has been reported to the OpenStack Vulnerability Management Team in
private. The reporters and upstream developers have worked together to address
the issue with fixes and an embargo date
has been set to Tuesday, 2024-07-23, 15:00 UTC (17:00 CEST). At this point in
time, the patches will get merged and the OpenStack Security Advisory
<!--TODO: Fix reference!-->
(<a href="https://security.openstack.org/ossa/OSSA-2024-002.html">OSSA-2024-002</a>) will
be published. The issue is tracked in OpenStack issue
<a href="https://bugs.launchpad.net/nova/+bug/2071734">#2071734</a>, which should become
publically accessible after the lift of the embargo and the publication
of this advisory.</p>

<p>Under the used responsible disclosure approach, the information was shared with
a select group of trustable users of OpenStack, so they can prepare updates and
protect their user data in time for the publication.</p>

<h2 id="mitigation-and-fixes">Mitigation and Fixes</h2>

<p>Temporary workarounds that would disable image uploads for QCOW2
and VMDK formats are not desirable and incomplete, as images can also
be created from volumes, which would also have to be blocked.
The complexity of doing all the changes exceeds the complexity of
deploying the fixes.
A better workaround would be to <em>undo</em> the setting of <code class="language-plaintext highlighter-rouge">use_cow_images=False</code>
in the nova configuration, as this stops all known exploitable code paths
from being used.</p>

<p>There are patches from the upstream OpenStack developers available. They work
by rejecting images in Nova where contents and the claimed format do not match
and require that a format inspector is available prior to further processing
them. This provides effective protection against confusing Novaâ€™s image
handling.</p>

<p>Note that the upstream changes also include improvements to the handling
of ISO images from Jens Harbott (OSISM), which have further tighten the
inspection and which have been merged and backported upstream already without
having received a separate advisory (due to not having fixed known exploitable
situations).</p>

<p>The reference implementation for the IaaS layer of Sovereign Cloud Stack
is provided by the OSISM project â€“ the OSISM team normally builds the
artifacts in a completely public process. To avoid waiting for a few
hours to have all image builds (nova-compute containers)
completed and tested after the disclosure date,
the OSISM project has built private images beforehand which we have tested
to protect against all known scenarios in which these image files are used.
These images were handed to our SCS operators a few hours ahead of time
(without a detailed description) to allow them to protect their infrastructure.</p>

<p>Instructions to install the fixed containers (hotfix on top of
<a href="https://osism.tech/de/docs/release-notes/">OSISM 7.0.x/OSISM 7.1.0</a>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# Override nova-compute image in your configuration repository:
cat &gt;environments/kolla/images.yml &lt;&lt;EOT
---
my_registry_kolla: osism.harbor.regio.digital
my_namespace2: osism-20240723
nova_compute_tag: build-20240717-stable-2023.2
nova_compute_image: "{{ my_registry_kolla }}/{{ my_namespace2 }}/nova-compute"
EOT
</code></pre></div></div>

<p>Now, the nova compute image will be downloaded and rolled out on all nova compute nodes:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osism apply <span class="nt">-a</span> pull nova <span class="nt">-l</span> compute     <span class="c"># optional</span>
osism apply <span class="nt">-a</span> refresh-containers nova <span class="nt">-l</span> compute
</code></pre></div></div>
<p>If you are not yet on R6 (OSISM 7.0.x), replace <code class="language-plaintext highlighter-rouge">stable-2023.2</code> with the version you are on 
(e.g. <code class="language-plaintext highlighter-rouge">stable-2023.1</code> if you are on R5 (OSISM 6.x).</p>

<p>Note that the above instructions do NOT contain cinder and glance images; they should
have been fixed already with the installation of fixes for CVE-2024-32498 or with
the rollout of OSISM 7.1.0.</p>

<p>The deployment will have the following user-visible effects:</p>
<ul>
  <li>VM (compute service) operations will not be available for some seconds.</li>
</ul>

<p>Most users wonâ€™t notice this. Please note that running workloads will not be
affected at all.</p>

<p>After the upstream patches have been merged in the hours after the disclosure
date, OSISM will build, test and publish an official 7.1.1 release
containing the updated containers (nova-compute, glance-api, cinder-volume)
as well as a fix for octavia-api. Please refer to the
<a href="https://osism.tech/docs/release-notes/osism-7/">OSISM release notes</a>.
You can upgrade from this hotfix toiOSISM 7.1.1 using the regular upgrade mechanism.</p>

<p>If your exposure is low (e.g. private cloud or <em>not</em> using <code class="language-plaintext highlighter-rouge">use_cow_images=False</code>)
you may decide to wait for the regular 7.1.1 and go there directly from 7.x.</p>

<p>Warning: If you are still on OSISM 7.0.x (not 7.1.x yet) and create the <code class="language-plaintext highlighter-rouge">images.yml</code> as
described here, <code class="language-plaintext highlighter-rouge">osism apply -a pull</code> and <code class="language-plaintext highlighter-rouge">osism apply -a refresh-containers</code>
will use the base 7.0.x containers with just the single <code class="language-plaintext highlighter-rouge">nova_compute</code>
override which would make you vulnerable to the glance and cinder based
attacks from CVE-2024-32498 again.
We recommend to avoid this by using the latest 7.1.0 release.
If you canâ€™t, you can either ensure you avoid pulling and refreshing containers
other than the <code class="language-plaintext highlighter-rouge">nova_compute</code> one or you construct a combined <code class="language-plaintext highlighter-rouge">images.yml</code> from the
description in <a href="https://scs.community/de/security/2024/07/02/cve-2024-32498/">CVE-2024-32498</a>
and the above section. The latter would ensure you have all needed image overrides for
both CVEs.</p>

<h2 id="have-my-systems-been-compromised">Have my systems been compromised?</h2>

<p>Providers that are unable to patch this issue on the day of the release
and use <code class="language-plaintext highlighter-rouge">use_cow_images=False</code> in their nova configuration
need to consider the possibility of having been attacked. In this case,
passwords/keys for internal communication should be considered to be
leaked and will need to be rotated to reestablish the defense-in-depth
lines. We recommend providers check for suspicious image operations
(QCOW2 and VMDK image registrations, snapshots with QCOW2 signature) in
their logs for the time after the embargo lift.
In particular, every QCOW2 image that has been uploaded should be investigated
for the datafile property; it should be assumed that images that have been
registered and removed again contain the exploit.
VMDK images with external Flatfile references (<code class="language-plaintext highlighter-rouge">createType="monolithicFlat"</code>)
are suspicious as well. Evil images should also be pruned from the image cache.</p>

<h2 id="patch-status-of-scs-clouds">Patch status of SCS clouds</h2>

<p>Our publically known providers of SCS IaaS platforms have all been
notified and have started to ensure that their <code class="language-plaintext highlighter-rouge">use_cow_images</code> setting
does not expose them and have started the rollout of updated images which
we were able to provide them privately a few hours ahead of time (without
sharing all the details on the issue). We expect that none of them has
any exploitable vulnerability left  open by the time this gets public.
Please refer to their communication for precise information on the
patch status.</p>

<h2 id="thanks">Thanks</h2>

<p>The authors would like to thank Arnaud Morin, Jens Harbott, the OpenStack
developers and reviewers, testers and the OpenStack Vulnerability Management
Team for the responsible reporting, careful analysis, fixing, testing and
professional handling of the issue and the OSISM team for providing the fixed
containers.</p>

<h2 id="sovereign-cloud-stack-security-contact">Sovereign Cloud Stack Security Contact</h2>

<p>SCS security contact is <a href="mailto:security@scs.community">security@scs.community</a>, as published on
<a href="https://scs.community/.well-known/security.txt">https://scs.community/.well-known/security.txt</a>.</p>

<h2 id="version-history">Version history</h2>

<ul>
  <li>Initial Draft, v0.1, 2024-07-20, 10:00 CEST.</li>
  <li>More precise information on exploitability with <code class="language-plaintext highlighter-rouge">use_cow_images=False</code>, v0.2, 2024-07-20, 11:30 CEST.</li>
  <li>Installation instructions, v0.3, 2024-07-20, 14:30 CEST.</li>
  <li>Fix install instructions, v0.4, 2024-07-22, 17:45 CEST.</li>
  <li>Escape jijna templates, v0.5, 2024-07-22, 18:30 CEST.</li>
  <li>Move installation instructions into the fixes section, add combined install insns, v0.6, 2024-07-23, 15:15 CEST.</li>
  <li>Replaced combined install instructions with a wraning, v0.7, 2024-07-23, 16:15 CEST.</li>
  <li>Final review for pubication, v1.0, 2024-07-23, 17:00 CEST.</li>
</ul>



<h2 id="about">
  
    Ãœber den Autor
  
</h2>




<div class="d-flex flex-md-row flex-column align-items-center mb-5">
    <div class="me-4 d-flex align-items-center">
      <svg height="120" width="120">
        
        <mask id="863bd7ec3614">
          <circle cx="60" cy="60" r="60" fill="white"/>
        </mask>
        <image x="0" y="0" height="120" width="120" xlink:href="/assets/df1432-681b5ce9a49552a823aa099e6235efe9d24827d7bdccd9f20cc1617ff256bf665859e77b12d20a486bfc8f9ae5b70db8771e626a5b23d6c4d3ab7d8652c95745.webp" mask="url(#863bd7ec3614)"></image>
      </svg>
    </div>
    <div class="d-flex flex-column pe-3">
        <div class="mb-0 text-center text-md-start"><b>Kurt Garloff</b></div>
        <div class="small text-muted mt-0 text-center text-md-start">CTO Sovereign Cloud Stack @ <a href="https://osb-alliance.com" target="_blank">Open Source Business Alliance</a></div>
        <div class="mt-2">While working on Physics as student and researcher in Dortmund, Wuppertal and Eindhoven, Kurt started to work with and on Linux, with first patches to the SCSI layer in the mid 90s. He has spent his post-university life in Open Source, as kernel engineer, leader of SUSE Labs (kernel, compiler, X11, security), and engineering and business leadership at SUSE. Since 2011 he has been working on Open Source cloud software, at Deutsche Telekom, as Freelancer, at T-Systems (as chief architect for the OTC) and also has been serving on the Open Infra Foundation's board. Since 2019 he has been pushing the Sovereign Cloud Stack idea which resulted in a publically funded project that he now technically leads. He still loves to occasionally write code (mostly python these days) or at least test out code from the colleagues and project. He spends his free time with his family or with running and playing table tennis.
</div>
        <div class="mt-2 d-flex flex-row flex-wrap">
          
<div class="me-2 mb-2">
    <a class="btn btn-mail" href="mailto:garloff@osb-alliance.com"><i class="fa fa-envelope fa-lg"></i></a>
</div>





<div class="me-2 mb-2">
    <a class="btn btn-linkedin" target="_blank" href="https://www.linkedin.com/in/kurt-garloff/"><i class="fa fa-linkedin fa-lg"></i></a>
</div>


<div class="me-2 mb-2">
    <a class="btn btn-github" target="_blank" href="https://github.com/garloff"><i class="fa fa-github fa-lg"></i></a>
</div>


<div class="me-2 mb-2">
    <a class="btn btn-matrix" target="_blank" href="https://matrix.to/#/@garloff:matrix.org"><i class="fa fa-matrix-org fa-lg"></i></a>
</div>

          <div class="ms-md-auto pe-3"><a href="/de/members/garloff" class="btn btn-outline-primary" role="button">Community-Profil &raquo;</a></div>
      </div>
    </div>
</div>



  </div>
  <!-- /.container -->
  <!-- Footer -->
<footer class="py-5 bg-dark">
  <div class="container text-light bg-dark">
    <div class="row">
      <div class="col-lg-5">
        <a href="#" class="footer-site-logo">
          <img alt="Sovereign Cloud Stack" class="img-fluid mb-2" src="/assets/images/SCS_short-1b31802be07ab137d2373f3cd2e268923d727ee1d19b6b577dff3b71610345de088c3b83c90f66897a21e52e84fa03c1ef4d1ca5193b8659b9c9535946aa0154.svg" integrity="sha512-GzGAK+B6sTfSNz880uJokj1yfuHRm2tXff87cWEDRd4IjDuDyQ9miXoh5S6E+gPB700cpRk7hlm5yVNZRqoBVA==" crossorigin="anonymous">
        </a>
        <p class="small my-1">Sovereign Cloud Stack, SCS und das Logo sind geschÃ¼tzte Marken der Open Source Business Alliance e.V. â€” Sonstige Marken sind Eigentum ihrer jeweiligen Besitzer.</p>
        <ul class="list-inline mt-2 mb-1">
          
          <li class="list-inline-item small me-sm-4 me-3">
            <i class="text-light fa fa-phone me-1"></i> <a class="text-light text-decoration-none" href="tel:+49-30-300149-3377" title="+49-30-300149-3377">+49-30-300149-3377</a>
          </li>
          
          <li class="list-inline-item small me-sm-4 me-3">
            <i class="text-light fa fa-envelope me-1"></i> <a class="text-light text-decoration-none" href="mailto:scs@osb-alliance.com" title="scs[at]osb-alliance[dot]com">scs[at]osb-alliance[dot]com</a>
          </li>
          
        </ul>
      </div>
      <div class="col-lg-7">
        <ul class="list-inline text-lg-end mt-1 mb-1">
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://social.osb-alliance.de/@SCS">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-mastodon fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://www.linkedin.com/company/sovereigncloudstack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-linkedin-square fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://www.youtube.com/@sovereigncloudstack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-youtube-square fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://github.com/SovereignCloudStack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-github fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-matrix-org fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://scs.sovereignit.de/mailman3/postorius/lists/announce.lists.scs.community/">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-bullhorn fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="/feed.xml">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-rss fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
        </ul>
        <ul class="list-inline text-lg-end mt-2">
          
          <li class="list-inline-item me-2 ms-lg-2">
            <a class="text-light text-decoration-none" title="Impressum" href="/de/imprint/">Impressum</a>
          </li>
          
          <li class="list-inline-item me-2 ms-lg-2">
            <a class="text-light text-decoration-none" title="DatenschutzerklÃ¤rung" href="/de/dataprotection/">DatenschutzerklÃ¤rung</a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
  <!-- /.container -->
</footer>

</body>

</html>
