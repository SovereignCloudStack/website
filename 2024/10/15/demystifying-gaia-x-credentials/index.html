<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  

  <title>Demystifying Gaia-X Credentials | Sovereign Cloud Stack</title>
  <meta property="og:title" content="Demystifying Gaia-X Credentials | Sovereign Cloud Stack">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:locale" content="en" />
<meta name="description" content="This blog post will introduce the requirements and detailed technical process of creating and obtaining Verifiable Credentials (VC for short) for Gaia-X and using the Gaia-X Digital Clearing House (GXDCH) to assert compliance." />
<meta property="og:description" content="This blog post will introduce the requirements and detailed technical process of creating and obtaining Verifiable Credentials (VC for short) for Gaia-X and using the Gaia-X Digital Clearing House (GXDCH) to assert compliance." />
<link rel="canonical" href="https://sovereigncloudstack.github.io/website/2024/10/15/demystifying-gaia-x-credentials/" />
<meta property="og:url" content="https://sovereigncloudstack.github.io/website/2024/10/15/demystifying-gaia-x-credentials/" />
<meta property="og:site_name" content="Sovereign Cloud Stack" />
<meta property="og:image" content="https://sovereigncloudstack.github.io/website/website/assets/images/default-card-d32fdb798ca15ae927f00593ce64407f69c70d4011955dc94c7be76b99c474f4e673ee1a26ec53725dda80c2c331e5ad4300a43e702171cc014cd47ec6b2f94d.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-15T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://sovereigncloudstack.github.io/website/website/assets/images/default-card-d32fdb798ca15ae927f00593ce64407f69c70d4011955dc94c7be76b99c474f4e673ee1a26ec53725dda80c2c331e5ad4300a43e702171cc014cd47ec6b2f94d.jpg" />
<meta property="twitter:title" content="Demystifying Gaia-X Credentials" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-30T08:38:05+00:00","datePublished":"2024-10-15T00:00:00+00:00","description":"This blog post will introduce the requirements and detailed technical process of creating and obtaining Verifiable Credentials (VC for short) for Gaia-X and using the Gaia-X Digital Clearing House (GXDCH) to assert compliance.","headline":"Demystifying Gaia-X Credentials","image":"default-card.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://sovereigncloudstack.github.io/website/2024/10/15/demystifying-gaia-x-credentials/"},"url":"https://sovereigncloudstack.github.io/website/2024/10/15/demystifying-gaia-x-credentials/"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://sovereigncloudstack.github.io/website/feed.xml" title="Sovereign Cloud Stack" />


  <!-- Bootstrap core JavaScript -->
  <script src="/website/assets/vendor/jquery/jquery-9890bc3f6e101de456f751d876e987f1f4b90f5ad9df054375f77306c1afa9aa5781536b68c7a14d9653b12f5f22e6f2b3b363f583e4b1a7f079be6dfa5854d1.js" type="text/javascript"></script>
  <script src="/website/assets/vendor/bootstrap/js/bootstrap.bundle-60934d7b67216797538563fa77a226032bb2823e090abf271dd8f8772c72643f26033fb09fde7cf02e8520dee7b9b4d583e4ae0cf81c9a492f0695e3cf85eb30.js" type="text/javascript"></script>
  <!-- Lighbox -->
  <script src="/website/assets/vendor/lightbox-5dc80144ffe76fd27b40a8e12589c5d0d75b711ed7a7673347d8432a0d910ed4412e58da517985a7e84118687326c43f9ecadf23563007d27225b8688ab94ccc.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="/website/assets/css/lightbox-49997aacc14bff6792a1811e3616ecba8d58e0e4598c6f84c2800946d62462c8ed8fcfdf6f10088844e274b9482ffee4fbf6d37d67f85c0f1514e993ad3b9072.css">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="/website/assets/css/main-ed12d9c273c732a194d0f8e3ec09afcd4282bb2b71530e644874b2d51197007ff8f26efce55b40a901be813a91f54d6b02914d44316cfa360c4d45db632323cb.css">
  <!-- Pygments CSS -->
  <link rel="stylesheet" type="text/css" href="/website/assets/css/pygments-css/zenburn-b9e6749823dd76c51d2a88eb53602d9218592303de1e7d1a4523c503894f18810ddd0f4062286c1dbd89a9405bfe9020d23afce2785ef82c5ea814129bd4327a.css">
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/website/assets/images/apple-touch-icon-50d41dce7bb6498cab01cffd5f46e59a664056fd725ecf84d9c8e5ad9ac8ca1470a0b82fe79789d09136c4a7999658948394d89d9764e4174dfeec26fa7636ae.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/website/assets/favicon-32x32-c5b260bd36bab2cb0496cec647907efc38ca4ac5cb5c978603405fe682da762b16d3b21e997fc85c1c76db4e4bae08787a9a9cbfeb38c7b796ea6de38011953b.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/website/assets/favicon-16x16-01a7499e8495e00e13117aca0a759d19faeca0c8fe23c003bf5aabef7b7b5abbbb1ad3d149d0630d9997f941fb53e13d85a950be0104d76283df37fbaba34717.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="mask-icon" color="#50c3a5" href="/website/assets/images/safari-pinned-tab-3194c271a2bc561b5707fb2998d39947f8feeabebcc64dfb41004e04f7ae120a6ae7157839c91b2b6f0920545a23959142d86e565ba6250800bafb99a2237583.svg" />
  <meta name="msapplication-config" content="/browserconfig.xml" />
  <meta name="msapplication-TileColor" content="#50c3a5">
  <meta name="theme-color" content="#ffffff">
</head>

<nav class="navbar navbar-light fixed-bottom" style="background-color: var(--bs-warning)">
  <div class="container">
    <span><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Staging website – Based on commit <a href="https://github.com/SovereignCloudStack/website/commit/685a8141acabe7a4df24689815448ee259e39dda" target="_blank"><span class="badge rounded-pill bg-secondary">685a81</span></a></span>
  </div>
</nav>

<body class="d-flex flex-column min-vh-100">
  <!-- Navigation -->
<nav class="navbar navbar-dark bg-gold sticky-top" style="height: 55px;">
  <div class="container d-flex justify-content-center">
	  <a class="lh-1 fw-bolder link-unstyled text-center stretched-link" href="https://sovereigncloudstack.org/">Discover our new web page</a>
  </div>
</nav>
<nav class="navbar navbar-expand-lg navbar-light sticky-top bg-light">
  <div class="container align-items-start">
    <div class="d-lg-flex flex-row flex-fill align-items-end">
      <button
        class="navbar-toggler me-auto"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto">
          
          <li class="nav-item">
            
              <a class="nav-link" href="/website/">
                Home
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Discover SCS
              </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  
                    <li><a class="dropdown-item" href="/website/about/">About SCS</a></li>
                  
                    <li><a class="dropdown-item" href="/website/use/">Use SCS</a></li>
                  
                    <li><a class="dropdown-item" href="/website/contribute/">Contribute to SCS</a></li>
                  
                    <li><a class="dropdown-item" href="/website/partners/">Service partners</a></li>
                  
                    <li><a class="dropdown-item" href="/website/members/">Community members</a></li>
                  
              </ul>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/website/news/">
                News
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/website/events/">
                Events
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/website/jobs/">
                Open positions
              </a>
            
          
          <li class="nav-item">
            
              <a class="nav-link" href="/website/tenders/">
                Public tenders
              </a>
            
          
          </li>
          <li><a class="nav-link" href="https://docs.scs.community">Documentation</a></li>
        </ul>
        <ul class="navbar-nav flex-row align-content-end">
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://social.osb-alliance.de/@SCS">
              <i class="fa fa-mastodon fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://www.linkedin.com/company/sovereigncloudstack">
              <i class="fa fa-linkedin-square fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://www.youtube.com/@sovereigncloudstack">
              <i class="fa fa-youtube-square fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://github.com/SovereignCloudStack">
              <i class="fa fa-github fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org">
              <i class="fa fa-matrix-org fa-lg"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="https://scs.sovereignit.de/mailman3/postorius/lists/announce.lists.scs.community/">
              <i class="fa fa-bullhorn"></i>
            </a>
          </li>
          
          <li class="nav-item my-auto me-3 mx-lg-0">
            <a class="nav-link" target="_blank" rel="me" href="/feed.xml">
              <i class="fa fa-rss"></i>
            </a>
          </li>
          
        </ul>
      </div>
      <div class="d-none d-lg-block">
        <ul class="navbar-nav flex-row">
  <li class="nav-item my-auto ms-4 ms-lg-2">
    <a class="nav-link fw-bold  text-decoration-underline  " href="/website/2024/10/15/demystifying-gaia-x-credentials/">EN</a>
  </li>
  <li class="nav-item my-auto mx-2 mx-lg-0">
    <span class="nav-link px-0">/</span>
  </li>
  <li clas="nav-item my-auto">
    <a class="nav-link fw-bold  " href="/website/de/2024/10/15/demystifying-gaia-x-credentials/">DE</a>
  </li>
</ul>
      </div>
    </div>
    <div class="d-lg-none">
      <ul class="navbar-nav flex-row">
  <li class="nav-item my-auto ms-4 ms-lg-2">
    <a class="nav-link fw-bold  text-decoration-underline  " href="/website/2024/10/15/demystifying-gaia-x-credentials/">EN</a>
  </li>
  <li class="nav-item my-auto mx-2 mx-lg-0">
    <span class="nav-link px-0">/</span>
  </li>
  <li clas="nav-item my-auto">
    <a class="nav-link fw-bold  " href="/website/de/2024/10/15/demystifying-gaia-x-credentials/">DE</a>
  </li>
</ul>
    </div>
  </div>
</nav>
 <!-- Header -->
<header class="bg-white py-2 mb-2">
  <div class="container h-100">
    <div class="row h-100 align-items-center">
      <div class="col-lg-6 pe-lg-4">
        <div class="mt-5 mb-3">
          <img alt="Sovereign Cloud Stack" width="50%" class="img-fluid" src="/website/assets/images/SCS_horizontal-749ea34c9192a57edc36f112b92ac2eddb847d3e47643f37488b3d148c9b98a720215c0c8e17ad0d3837c9056ae6feae3cdc931ed36e911b2b1b61a20b417de6.svg">
        </div>
        <p class="lead text-black-50 mb-lg-3">
          One platform — standardized, built and operated by many.
        </p>
      </div>
      <div class="col-lg-6 text-lg-end text-nowrap my-auto">
        <a href="https://osb-alliance.com" target="_blank" class="text-decoration-none">
          <img alt="Open Source Business Alliance" width="25%" class="img-fluid" src="/website/assets/images/logo-osba-615e489a04d99f1ead83a6fa64d76dfc96d1f6a8448ee5457099e2bc8fddb235379f6607e917a0fcfb519ff1902ac5596213d7339ef9f48a0925aaf2b1221ee0.svg">
        </a>
        <a href="https://bmwk.de" target="_blank" class="text-decoration-none">
          <img alt="Bundesministerium für Wirtschaft und Klimaschutz" width="25%" class="img-fluid ms-5" src="/website/assets/images/logo-bmwk-funded-a4b929201f73ab45853836459b686db98f0b2e37189400588ce992a51c6c59d371835e93cd0d5b891f05fce75d6b87383c3fc12d52c6d560c5602eb32bf58b90.svg">
        </a>
        <a href="https://gaia-x.eu" target="_blank" class="text-decoration-none">
          <img alt="Gaia-X" width="30%" class="img-fluid ms-3" src="/website/assets/images/logo-gaiax-fbfa0132aaba3946d970e942fd98ef403abb12f8f344cc3087fcb466e23424b0d7dddd9b8b2ce4979df58e4b78e48f0419eb721e0f0599bd89df6b46c2871c43.svg">
        </a>
      </div>
    </div>
  </div>
</header>

  <!-- Page Content -->
  <div class="container mb-5">
    
<div class="d-flex w-100 flex-column mb-3">
	<h1 class="pb-1 mb-0"><small>Demystifying Gaia-X Credentials</small></h1>
	<div class="d-flex w-100 flex-row">
		<div style="max-width: 80px; max-height: 80px;" class="rounded-3 overflow-hidden ratio ratio-1x1">
			<div style="max-width: 80px; max-height: 80px;" class="overflow-hidden ratio ratio-1x1">

  <svg height="80" width="80">
    
    
    <mask id="401b0ab07d15">
      <rect width="80" height="80" fill="white"/>
    </mask>
    <mask id="f925055f6538">
        <circle cx="40" cy="40" r="40" fill="white"/>
    </mask>
    <image x="0" y="0" height="80" width="80" xlink:href="/website/assets/7e8a63-d6be5e84b8ba0825ad53a8b9d70623837869ad80f74d7c9eff6ddccd9d5a9a654fbcee42ceb3174f739e3736a4361351246fea395eefa1f43c80d87eb43a0faa.webp"
       mask="url(#f925055f6538)" 
    ></image>
  </svg>

</div>

		</div>
		<div class="d-flex w-100 flex-column ms-3 my-auto">
			<small class="mb-1 fw-bolder">Markus Hentsch, Anja Strunk</small>
			<small>
	October 15, 2024

</small>
		</div>
	</div>
</div>

<p>This blog post will introduce the requirements and detailed technical process of creating and obtaining Verifiable Credentials (VC for short) for Gaia-X and using the <a href="https://gaia-x.eu/gxdch/">Gaia-X Digital Clearing House (GXDCH)</a> to assert compliance.</p>

<p>We recommend reading the Gaia-X’s own blog post on <a href="https://gaia-x.eu/news-press/gaia-x-and-verifiable-credentials-presentations/">Gaia-X and Verifiable Credentials / Presentations</a> to get familiar with the idea and concepts behind <strong>Verifiable Credentials</strong> and <strong>Verifiable Presentations</strong>.</p>

<p>The process described in this blog post is for the most part an example realization of <a href="https://docs.gaia-x.eu/policy-rules-committee/policy-rules-conformity-document/23.10/Process/">how to become a Gaia-X conformant user</a> as documented by Gaia-X, further extended by the process of publishing Gaia-X compliant VCs for cloud service offerings as well.</p>

<p>This blog post will refer to the latest stable Gaia-X release at the time of writing (which is 22.10 - codenamed “Tagus”) and the corresponding <a href="https://docs.gaia-x.eu/policy-rules-committee/trust-framework/22.10/">Gaia-X Trust Framework 22.10 release</a>.
Details of the process described here might change in future Gaia-X releases. Please consult the corresponding documentation.</p>

<h2 id="terminology">Terminology</h2>

<p>It is important to clarify some terms and concepts used throughout this blog post before moving on.</p>

<h4 id="gaia-x-ontology">Gaia-X Ontology</h4>

<p>The <a href="https://gitlab.com/gaia-x/technical-committee/service-characteristics-working-group/service-characteristics">Gaia-X Ontology</a> defines a set of classes and their properties used to describe Gaia-X entites.
The latest version of the Gaia-X Ontology is published in the <a href="https://registry.lab.gaia-x.eu/docs/#menu">Gaia-X Registry</a> of the GXDCH.</p>

<h4 id="gaia-x-credentials--verifiable-credentials">Gaia-X Credentials / Verifiable Credentials</h4>

<p>Gaia-X regulates descriptions of <strong>Cloud Service Providers (CSPs)</strong> and their services as <strong>Gaia-X Credentials</strong>. A Gaia-X Credential is a set of crypographically signed claims about one or more Gaia-X entities. A Gaia-X entity is a <em>Participant</em> (including Service Consumer and Service Provider), a <em>Service Offering</em> and/or a <em>Resource</em>, a Service Offering is aggregated of.</p>

<p>The term <strong>Gaia-X Credential</strong> refers to a <strong>Verifiable Credential</strong> in the context of Gaia-X.
It is based on the <a href="https://www.w3.org/TR/vc-data-model/">W3C Verifiable Credentials Data Model v1.1</a> but follows some more specialized restrictions specific to Gaia-X.
Those are described in the <a href="https://docs.gaia-x.eu/technical-committee/identity-credential-access-management/22.10/credential_format/">Credential format documentation</a>.
Notable key aspects are:</p>

<ul>
  <li>The serialization format is <a href="https://json-ld.org/">JSON-LD</a>.</li>
  <li>The verification method (= public key to verify proof) type is <a href="https://datatracker.ietf.org/doc/html/rfc7517">JSON Web Key</a> entailing compacted <a href="https://w3c-ccg.github.io/lds-jws2020/">JSON Web Signature</a> as embedded proof value.</li>
  <li>Claims are expressed as <a href="https://www.w3.org/TR/rdf11-concepts/">Resource Description Framwork (RDF)</a> triples and <a href="https://docs.gaia-x.eu/technical-committee/identity-credential-access-management/22.10/credential_format/#namespace-bindings-and-contexts">MUST use</a> the Gaia-X Ontology in their context.</li>
  <li>Any <code class="language-plaintext highlighter-rouge">id</code> fields of Verifiable Credentials (including their <code class="language-plaintext highlighter-rouge">credentialSubject.id</code>) <a href="https://docs.gaia-x.eu/technical-committee/identity-credential-access-management/22.10/credential_format/#identifiers">MUST be unique</a>.</li>
</ul>

<p>In this blog post, the term Verifiable Credential is used interchangeably with Gaia-X Credential.</p>

<p>At the time of writing, the old term <strong>Self-Description</strong> is still encountered in a lot of resources concerning Gaia-X.
The term Self-Description was replaced by <strong>Gaia-X Credential</strong> a long time ago, but not all of the <a href="https://docs.gaia-x.eu/">Gaia-X documents</a> are updated accordingly yet.
This blog post uses the new term Gaia-X Credential.</p>

<h4 id="verifiable-presentations">Verifiable Presentations</h4>

<p>Claims about a Gaia-X entity may be distributed across multiple Gaia-X Credentials.
Furthermore, Gaia-X Credentials may contain references to other Gaia-X Credentials.
Gaia-X uses the concept of <strong>Verifiable Presentations</strong> following the <a href="https://www.w3.org/TR/vc-data-model/">W3C Verifiable Credentials Data Model</a> to combine all claims about a Gaia-X entity.</p>

<p>A <strong>Verifiable Presentation</strong> representing a Cloud Service Provider (CSP) and their offerings as a form of self-description is usually submitted to the Compliance Service of the GXDCH, resulting in a Gaia-X Credential that attests the compliance.</p>

<h2 id="desired-goal">Desired Goal</h2>

<p>This blog post will be based on the following use case:</p>

<p>A Cloud Service Provider (CSP) wants to publish Gaia-X Credentials containing proven claims about their identity and cloud service offerings conforming to the Gaia-X Framework and attest Gaia-X compliance.
To achieve this, the CSP assembles Verifiable Presentations that contain several Gaia-X Credentials which in total will both represent and prove the CSP’s identity as well as their offerings as a form of self-description.
The Gaia-X Credentials, representing individual claims, are individually issued and signed either by the CSP itself or an authorized third-party (such as the GXDCH) depending on their subjects.
Finally, the Gaia-X Compliance Service of the GXDCH will verify the Verifiable Presentation’s contents (including the individual Verifiable Credentials and their proofs) and issue a Verifiable Credential attesting the compliance of the Verifiable Presentation as a whole.</p>

<p>This process is summarized in the following figure, taking a Verifiable Presentation for a service offering as an example:</p>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-verifiable-presentation-f4f73257af24ef9113407db3588ec75cc372220a5dd0094b9a7242d834b7fdd986b6f7a0c32adfb5034c68cb1850650651133718f00c8e197cad9cb26bda0173.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-verifiable-presentation-f4f73257af24ef9113407db3588ec75cc372220a5dd0094b9a7242d834b7fdd986b6f7a0c32adfb5034c68cb1850650651133718f00c8e197cad9cb26bda0173.png" />
  </a>
</figure>

<p>Most Gaia-X Credentials included in a Verifiable Presentation are self-signed by the CSP.
One exception to this is the Gaia-X Credential for the Legal Registration Number (LRN) of the CSP which instead is signed by the GXDCH involving a dedicated Gaia-X Notarization Service API for verifying the LRN and attesting its validity.</p>

<p>The specific set of Gaia-X Credentials a CSP includes in each of their Verifiable Presentations may vary depending on what kind of proven claims the CSP wants to present therein.
For the purpose of this blog post we will focus on a very common and basic use case of Verifiable Presentations containing the following Gaia-X Credentials:</p>

<ol>
  <li>The <strong>Legal Registration Number</strong> (LRN) belonging to the CSP.</li>
  <li>The <strong>Legal Participant</strong> credential representing the CSP as a legal person identified by the LRN.</li>
  <li>The signed Gaia-X <strong>Terms &amp; Conditions</strong> which the CSP pledges to adhere to.</li>
  <li>The <strong>Service Offering</strong> credential representing the CSP’s digital service available for order.</li>
</ol>

<p>We will first create a Verifiable Presentation containing credentials no. 1 through 3 to represent a minimal set representing the CSP identity.
Following this, we will add credential no. 4 to create another Verifiable Presentation that covers the service offerings as well.</p>

<h2 id="required-identity-assets-for-credential-creation">Required Identity Assets for Credential Creation</h2>

<p>In order to successfully create Verifiable Credentials for the Gaia-X Compliance as illustrated above, the following assets are necessary on the CSP side:</p>

<ol>
  <li>A DNS record and web server for hosting the Gaia-X related identity assets</li>
  <li>A public/private key pair compatible with JSON Web Signatures (JWS) and a corresponding X.509 certificate chain containing the public key. GXDCH expected <a href="https://en.wikipedia.org/wiki/EIDAS">EIDAS</a> or <a href="https://en.wikipedia.org/wiki/Extended_Validation_Certificate">evSSL</a> certificate as trust anchor of x.509 certificate chain. Deployment endpoints of GXDCH accept <a href="https://letsencrypt.org/">Let’s Encrypt certificates</a> as trust anchor, too.  You can verify compliance of your x.509 certificate chain via <code class="language-plaintext highlighter-rouge">TrustAnchor/TrustAnchorController_findTrustAnchor</code> endpoint of GXDCH Registry Service.
    <ul>
      <li>the X.509 certificate chain needs to be hosted publicly</li>
    </ul>
  </li>
  <li>A <a href="https://www.w3.org/TR/did-core/">Decentralized Identifier (DID)</a> and a DID document associated with the DID. DID and DID document are linked via <a href="https://www.w3.org/TR/did-core/#methods">DID method</a>. This blog post uses <a href="https://w3c-ccg.github.io/did-method-web/">did:web method</a>. However, Gaia-X does not make any limitations with respect to used DID methods.
    <ul>
      <li>the DID document is a JSON file that needs to be hosted publicly at <code class="language-plaintext highlighter-rouge">&lt;DNS record&gt;/.well-known/did.json</code></li>
    </ul>
  </li>
</ol>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-credentials-creation-454f6f20879740a97b8bd5f0ad567a7367e5a3514d54e7da47d1bbe67db373faca1ea8308b2b3a4d5bcf93ec5208db3c680aaee3469a6226cc9b4411deb9ed34.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-credentials-creation-454f6f20879740a97b8bd5f0ad567a7367e5a3514d54e7da47d1bbe67db373faca1ea8308b2b3a4d5bcf93ec5208db3c680aaee3469a6226cc9b4411deb9ed34.png" />
  </a>
</figure>

<p>The relations between those parts are as follows:</p>

<ul>
  <li>the private key of the public/private key pair will be used by the CSP to locally sign Gaia-X Credentials</li>
  <li>the public key of the public/private key pair will be used by other parties to verify the signature of CSP-signed Gaia-X Credentials</li>
  <li>the public key is hosted by the CSP as part of the DID document and certificate chain files</li>
  <li>the DID document contains both the public key for signature validation as well as a URL reference to the full X.509 certificate chain for the public key</li>
  <li>the path to the public key is encoded in the “proof” section of the Gaia-X Credential. This reference points to a specific section in DID document, which describes the public key.</li>
</ul>

<p>Using the DID document and the certificate chain including the public key hosted by the CSP (acting as provider), a consumer will be able to verify the signature of a Gaia-X Credential issued by the CSP by resolving the DID reference and retrieving the certificate:</p>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-credentials-verification-93fa8e888eda7f48af7b84d037e088c572894c3eb49fade292e94a399169281d7afcd5d4cd20b0fc3f44ec126a160a92fc62cce4cb56a7e6a704b87401fa8705.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-credentials-verification-93fa8e888eda7f48af7b84d037e088c572894c3eb49fade292e94a399169281d7afcd5d4cd20b0fc3f44ec126a160a92fc62cce4cb56a7e6a704b87401fa8705.png" />
  </a>
</figure>

<h2 id="creating-a-compliant-verifiable-presentation-step-by-step">Creating a compliant Verifiable Presentation step-by-step</h2>

<p>The following sections of this blog post will guide through the individual steps of creating the necessary identity assets, basic Gaia-X Credentials and finally the first Verifiable Presentation about the CSP identity.
At the end, the process of generating a credential about service offerings and creating a second Verifiable Presentation incorporating it will be explained as well.</p>

<p>The steps will require an up and running web server with a registered DNS record where files can be served from.
This server and its DNS record will be referred to as <code class="language-plaintext highlighter-rouge">mydomain.com</code> for the explanations below.</p>

<h3 id="step-1-preparing-the-publicprivate-key-pair">Step 1: Preparing the public/private key pair</h3>

<p>For the purpose of this blog post we will be using Let’s Encrypt for generating the public/private key pair and X.509 certificate chain.
This makes the process very quick and easy and we can focus on the more intericate parts of the Gaia-X-specific workflow.
Note that for the Gaia-X production release, a X.509 certificate chain originating from one of the <a href="https://docs.gaia-x.eu/policy-rules-committee/trust-framework/22.10/trust_anchors/#list-of-defined-trust-anchors">Gaia-X Trust Anchors</a> will be required, which excludes Let’s Encrypt as it does not offer EV SSL certificates.
For testing this process, we can use the “v1-staging” Gaia-X API intended for development and testing purposes, which is a bit more lenient in this regard and will accept Let’s Encrypt certificates.</p>

<p>Please refer to the official <a href="https://certbot.eff.org/instructions">Certbot ACME client documentation</a> on how to get started with Let’s Encrypt on a web server.
Using Certbot to perform the key generation and certificate issuance results in the following files:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">privkey.pem</code>
    <ul>
      <li>the private key of your public/private key pair</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">cert.pem</code>
    <ul>
      <li>your resulting certificate (a leaf certificate), includes the public key of your key pair</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">chain.pem</code>
    <ul>
      <li>Let’s Encrypt’s intermediate certificate</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">fullchain.pem</code>
    <ul>
      <li>certificate chain, simply a combination of <code class="language-plaintext highlighter-rouge">cert.pem</code> and <code class="language-plaintext highlighter-rouge">chain.pem</code></li>
    </ul>
  </li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">chain.pem</code> certificate is only an intermediate certificate.
It references <a href="https://letsencrypt.org/certificates/#root-cas">Let’s Encrypt’s root certificate</a> (ISRG Root X1/X2) but the <code class="language-plaintext highlighter-rouge">fullchain.pem</code> does not include it.
Since the Gaia-X Compliance API will require the full certificate chain (including the root certificate) to be present for validation later on, the certificate chain needs to be adjusted.</p>

<p>This can be done by manually building the full certificate chain:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># start building the certificate chain from the leaf and intermediate certificates</span>
<span class="nb">cat </span>cert.pem chain.pem | <span class="nb">tee</span> /srv/.well-known/x509CertificateChain.pem

<span class="c"># retrieve and append the ISRG Root X1 certificate</span>
curl <span class="nt">-s</span> <span class="se">\</span>
    https://crt.sh/?d<span class="o">=</span>96BCEC06264976F37460779ACF28C5A7CFE8A3C0AAE11A8FFCEE05C0BDDF08C6 <span class="se">\</span>
    | <span class="nb">tee</span> <span class="nt">-a</span> /srv/.well-known/x509CertificateChain.pem
</code></pre></div></div>
<p>(this example assumes <code class="language-plaintext highlighter-rouge">/srv/</code> is the path your web server serves files from)</p>

<p>The <code class="language-plaintext highlighter-rouge">crt.sh</code> URL to the ISRG Root X1 certificate in this example was retrieved from <a href="https://wiki.mozilla.org/CA/Included_Certificates">Mozilla’s index of included CA certificates</a>.</p>

<p>Host the <code class="language-plaintext highlighter-rouge">x509CertificateChain.pem</code> on the web server accordingly.
It will be required for the next step.</p>

<p>If the web server is not configured for HTTPS yet, these key files may be used for its TLS configuration as well.</p>

<h3 id="step-2-creating-the-decentralized-identifier-did-document">Step 2: Creating the Decentralized Identifier (DID) document</h3>

<p>A central element of the whole process of verifying Verifiable Credentials is the Decentralized Identifier (DID for short) of the corresponding signee. Gaia-X uses <a href="https://www.w3.org/TR/did-core/">W3C’s DID standard</a> for those.
A DID document is linked to the private key used to sign Verifiable Credentials and contains verification assets (e.g. public key) for verification as illustrated in the introductory section.</p>

<p>The DID document must be publicly accessible and is usually referenced in Verifiable Credentials using the <a href="https://www.w3.org/TR/did-core/#a-simple-example">DID-specific URI scheme</a>, for example: <code class="language-plaintext highlighter-rouge">did:web:my-domain.com</code>.
The <a href="https://w3c-ccg.github.io/did-method-web/"><code class="language-plaintext highlighter-rouge">did:web</code> method</a> specified in the example will resolve to <code class="language-plaintext highlighter-rouge">https://my-domain.com/.well-known/did.json</code>.</p>

<p>Some notes about the <code class="language-plaintext highlighter-rouge">did:web</code> method used here:</p>

<ul>
  <li>HTTPS (TLS) is mandatory for the <code class="language-plaintext highlighter-rouge">did:web</code> method and is automatically chosen.</li>
  <li>When no path segments are specified after the domain name (using colon delimiters), this method defaults to <code class="language-plaintext highlighter-rouge">.well-known/</code> on the web server.</li>
  <li>The resulting URL will be used to look up <code class="language-plaintext highlighter-rouge">did.json</code> on the web server, this filename is hardcoded.</li>
</ul>

<p>To generate the DID document, the <a href="https://github.com/SovereignCloudStack/scs-did-creator/">SCS DID creator</a> can be utilized.
Specify the URL to <code class="language-plaintext highlighter-rouge">x509CertificateChain.pem</code> certificate chain file as input for the verification methods.</p>

<p>Make sure to double check that you don’t accidentally reference your private key in the DID document!
In the context of your key pair, only the public key and a reference to the X.509 certificate chain should be part of this document.</p>

<p>If done correctly, the DID document should contain our public key and the URL of the <code class="language-plaintext highlighter-rouge">x509CertificateChain.pem</code> file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"verificationMethod"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com#JWK2020-RSA"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JsonWebKey2020"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"publicKeyJwk"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"n"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;public key here&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"x5u"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/x509CertificateChain.pem"</span><span class="w">
        </span><span class="err">...</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="err">...</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>(contents truncated for readability)</p>

<p>This file is to be placed as <code class="language-plaintext highlighter-rouge">/.well-known/did.json</code> on the web server, e.g. <code class="language-plaintext highlighter-rouge">mydomain.com/.well-known/did.json</code>.
As a result it will be accessible using the DID reference <code class="language-plaintext highlighter-rouge">did:web:mydomain.com</code> which we will be using when creating Gaia-X Credentials in the following steps.</p>

<p><strong>Important:</strong> Each <code class="language-plaintext highlighter-rouge">verificationMethod</code> entry in the DID document receives a unique <code class="language-plaintext highlighter-rouge">id</code> field. When creating Verifiable Credentials referencing the DID document, their <code class="language-plaintext highlighter-rouge">proof.verificationMethod</code> value must exactly match one of the <code class="language-plaintext highlighter-rouge">id</code>s within <code class="language-plaintext highlighter-rouge">verificationMethod</code> of the DID document! This includes the <code class="language-plaintext highlighter-rouge">#</code>-prefixed appendix (<code class="language-plaintext highlighter-rouge">did:web:mydomain.com#JWK2020-RSA</code> in this example).</p>

<h3 id="step-3-gaia-x-credential-for-legal-registration-number-lrn">Step 3: Gaia-X Credential for Legal Registration Number (LRN)</h3>

<p>To be acknowledged as a proper participant in the Gaia-X Trust Framework we need to legally identify ourselves as a <a href="https://docs.gaia-x.eu/policy-rules-committee/trust-framework/22.10/participant/#legal-person">legal person</a> that represents our entity (e.g. company).
For this purpose we need a Gaia-X Credential for our Legal Registration Number (LRN) as a requirement for our Participant Gaia-X Credential later on.</p>

<p>As mentioned in the introductory sections, the LRN Gaia-X Credential takes a special position in this context as it is one of the few Credentials that is not signed by the CSP itself.
Instead, the trust anchor lies at the GXDCH which verifies the LRN and attests its validity.
The Clearing House has a dedicated API for this: the Notarization API.
You can use the <a href="https://wizard.lab.gaia-x.eu/legalRegistrationNumber">Gaia-X Wizard</a> for creating the Gaia-X Credentials or use the Notarization API directly.</p>

<p>There is a notable quirk about the process here that needs some explanation before we go on.
When requesting a LRN Gaia-X Credential a <strong>Verifiable Credential identifier</strong> must be provided.
This corresponds to “Verifiable Credential ID” in the Gaia-X Wizard or the “vcid” path parameter of the API.
In addition to that a <strong>credential subject identifier</strong> will need to be specified as well.
This corresponds to “Credential subject ID” in the Gaia-X Wizard or the “id” request body field when using the API.
Below is a visualization of this structure:</p>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-lrn-credential-structure-595dd7f034dfdfbd79d36e0b1af5c6c4c38b5ad474066eda64d2432a1536e9710b1c150e1aa19fc1f0f22ff320efc92cef57b7e682a7e819bed4f370f1e2e3ce.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-lrn-credential-structure-595dd7f034dfdfbd79d36e0b1af5c6c4c38b5ad474066eda64d2432a1536e9710b1c150e1aa19fc1f0f22ff320efc92cef57b7e682a7e819bed4f370f1e2e3ce.png" />
  </a>
</figure>

<p>Instead of using a identifier that is only valid locally within a Verifiable Presentation (more on that later) we can opt for both identifiers to contain the URL to hosted instance of our LRN Gaia-X Credential.
For the purpose of demonstration, we will do that next but keep in mind that this is optional for Verifiable Credentials as the <a href="https://docs.gaia-x.eu/technical-committee/identity-credential-access-management/22.10/credential_format/#identifiers">Gaia-X documentation on identifiers</a> states:</p>

<blockquote>
  <p>It is up to the issuer to decide if the @id is a resolvable URI or not.</p>
</blockquote>

<p>Strictly speaking, we are not the issuer this time around (the GXDCH is) but since the Notarization API allows us to specify those identifiers, we will keep that responsibility nonetheless and have the choice here.</p>

<p>We are just about to receive the Gaia-X Credential and as such we don’t have the URL to it yet that we want to use in the identifiers, so the process can seem a bit unintuitive.
The solution is to prematurely specify the URL where we <em>intend</em> to put the Gaia-X Credential, in our example this will be <code class="language-plaintext highlighter-rouge">https://mydomain.com/.well-known/lrn.json</code>.
The link is not actually validated by the Notarization API as it only issues the Gaia-X Credential itself.
To adhere to the requirement of keeping identifiers unique, we can use a trick to attach arbitrary anchors to the URL in order to keep both identifiers different while still resolving to the same URL:</p>

<ul>
  <li>Verifiable Credential identifier: <code class="language-plaintext highlighter-rouge">https://mydomain.com/.well-known/lrn.json</code></li>
  <li>Credential subject identifier: <code class="language-plaintext highlighter-rouge">https://mydomain.com/.well-known/lrn.json#subject</code></li>
</ul>

<p>A corresponding request body to the Tagus release version of the Notarization API would look as follows.</p>

<p>Request URL:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST https://registrationnumber.notary.lab.gaia-x.eu/v1/registrationNumberVC?vcid=https://mydomain.com/.well-known/lrn.json#subject
</code></pre></div></div>

<p>Request Body:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://registry.lab.gaia-x.eu/v1-staging/api/trusted-shape-registry/v1/shapes/jsonld/participant"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:legalRegistrationNumber"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"gx:vatID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE123456789"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note: It is not mandatory to use the <code class="language-plaintext highlighter-rouge">/.well-known/</code> directory here.
In contrast to the DID document, web server, path and filename can be arbitrary here as long as we host the resulting Gaia-X Credential at this address later on.
This is true for all the Gaia-X Credentials that we will create in the following sections.</p>

<p>The Notarization API supports different types of Legal Registration Numbers, including VAT ID which our example uses.</p>

<p>In the response to this request we receive our first Gaia-X Credential from the Notarization API in JSON format.
Below is an example of how such a Gaia-X Credential will look like based on the request data above.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"https://w3id.org/security/suites/jws-2020/v1"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"VerifiableCredential"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:registration.lab.gaia-x.eu:v1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"issuanceDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-25T14:38:38.898Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://registry.lab.gaia-x.eu/developmhttps://cloudandheat.com/gaia-x/x509_cert_chain.pement/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:legalRegistrationNumber"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json#subject"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gx:vatID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE123456789"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gx:vatID-countryCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"evidence"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"gx:evidenceURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://ec.europa.eu/taxation_customs/vies/services/checkVatService"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:executionDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-25T14:38:38.898Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:evidenceOf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:vatID"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JsonWebSignature2020"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-06-25T14:38:38.916Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"proofPurpose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assertionMethod"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"verificationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:registration.lab.gaia-x.eu:v1#X509-JWK2020"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"jws"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;signature&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>(the JWS signature field has been replaced by the placeholder <code class="language-plaintext highlighter-rouge">&lt;signature&gt;</code> for readability)</p>

<p>We will put this JSON file on our web server at the path we specified during the request, i.e., <code class="language-plaintext highlighter-rouge">mydomain.com/.well-known/lrn.json</code>.</p>

<p>The Gaia-X Credential that we received contains a DID reference to the DID document of the Gaia-X Notarization Service which in turn will reference a X.509 certificate chain of the Notarization Service that can be used to validate the signature of the Gaia-X Credential.
Refer to the <a href="#appendix">appendix section</a> at the bottom of this blog post for a Python code snippet for validating the signature.</p>

<p>In contrast to the figures above, the issuer is the GXDCH and the CSP itself is just the holder of this Gaia-X Credential:</p>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-lrn-credential-creation-8af3137637d98afd4cadc287f8dd8663f5084fc3d3daa8c578e740cf70a839afb06e05f08347de83e378d83c4042316eac06f0d5fde907ec3c68fe15752e2ad6.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-lrn-credential-creation-8af3137637d98afd4cadc287f8dd8663f5084fc3d3daa8c578e740cf70a839afb06e05f08347de83e378d83c4042316eac06f0d5fde907ec3c68fe15752e2ad6.png" />
  </a>
</figure>

<p>Based on this LRN credential we can proceed with our first self-signed Gaia-X Credential next: the Participant.</p>

<h3 id="step-4-gaia-x-credential-for-participant">Step 4: Gaia-X Credential for Participant</h3>

<p>The <a href="https://docs.gaia-x.eu/policy-rules-committee/trust-framework/22.10/participant/">Participant in the Gaia-X Trust Framework</a> is described as:</p>

<blockquote>
  <p>[…] a Legal Person or Natural Person, which is identified, onboarded and has a Gaia-X Credential.</p>
</blockquote>

<p>In case of a Legal Person (our case), the Legal Registration Number is required which we just acquired the Gaia-X Credential for in the previous step.</p>

<p>Since the Participant Gaia-X Credential will be the first credential that we sign ourselves in this process, we will need three additional key assets that we prepared in earlier steps:</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">privkey.pem</code>, our private key for signing the credential.</li>
  <li>The <code class="language-plaintext highlighter-rouge">did:web:</code> reference pointing to our hosted DID document, which in turn points to our hosted certificate chain.</li>
  <li>The credential subject identifier of our LRN Gaia-X Credential to reference to.</li>
</ol>

<p>The LRN credential’s <code class="language-plaintext highlighter-rouge">credentialSubject.id</code> value will need to be specified within <code class="language-plaintext highlighter-rouge">credentialSubject.gx:legalRegistrationNumber.id</code> of the Participant Gaia-X Credential:</p>

<figure class="figure mx-auto d-block" style="width:50%">
  <a href="/website/assets/images/blog/gx-credentials/gx-participant-lrn-reference-80d6abdc827f6a211cbd3020536ef647ae43ca10dab9985f110e39c67d0a3b9ff55c86916404fcc258d54645c663d4fd04ac022750251aad2f67db15d9707384.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-participant-lrn-reference-80d6abdc827f6a211cbd3020536ef647ae43ca10dab9985f110e39c67d0a3b9ff55c86916404fcc258d54645c663d4fd04ac022750251aad2f67db15d9707384.png" />
  </a>
</figure>

<p>This time we are going to create and sign the Gaia-X Credential ourselves.
Here is how it could look like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://w3id.org/security/suites/jws-2020/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://registry.lab.gaia-x.eu/v1-staging/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"VerifiableCredential"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/participant.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuanceDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T00:00:00.000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/participant.json#subject"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:LegalParticipant"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gx:legalName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Company Ltd."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gx:legalRegistrationNumber"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json#subject"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"gx:headquarterAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"gx:countrySubdivisionCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE-BE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"gx:legalAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"gx:countrySubdivisionCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE-BE"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note that similar to the LRN Gaia-X Credential we are once again specifying a URL that does not exist yet for this credential’s identifiers: <code class="language-plaintext highlighter-rouge">https://mydomain.com/.well-known/participant.json</code>.
We will place this very credential there once we signed it.
Furthermore, we are using the same anchor method (<code class="language-plaintext highlighter-rouge">#subject</code>) to keep identifiers unique as already explained for the LRN credential earlier.</p>

<p>To sign the Gaia-X Credential we need to add a JSON Web Signature (JWS) to it.
Please refer to the appendix at the bottom of this blog post for an example Python implementation utilizing the <code class="language-plaintext highlighter-rouge">jwcrypto</code> library.
As a result, the structure shown above will be extended by a “proof” section containing the signature like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="err">...</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JsonWebSignature2020"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"proofPurpose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assertionMethod"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"verificationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com#JWK2020-RSA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"jws"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;signature&gt;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>To make the identifier references valid, we will place the signed JSON at <code class="language-plaintext highlighter-rouge">mydomain.com/.well-known/participant.json</code> on our web server.
Other Gaia-X Participants may now retrieve this Gaia-X Credential along with our DID document and its referenced X.509 certificate chain in order to validate the signature of our credential as illustrated in the figures of the introductory sections.</p>

<h3 id="step-5-gaia-x-credential-for-terms--conditions">Step 5: Gaia-X Credential for Terms &amp; Conditions</h3>

<p>The second Gaia-X Credential that we will sign ourselves will be the Gaia-X Terms &amp; Conditions which we pledge to adhere to as a participant in the Gaia-X Trust Framework.</p>

<p>The mandatory Terms &amp; Conditions text can be found at <code class="language-plaintext highlighter-rouge">https://registry.lab.gaia-x.eu/v1-staging/api/termsAndConditions</code> endpoint of GXDCH Registry Service.
A resulting credential JSON using example values may look like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://w3id.org/security/suites/jws-2020/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://registry.lab.gaia-x.eu/v1-staging/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VerifiableCredential"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuanceDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T00:00:00.000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:GaiaXTermsAndConditions"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gx:termsAndConditions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The PARTICIPANT signing the Self-Description agrees as follows:</span><span class="se">\n</span><span class="s2">- to update its descriptions about any changes, be it technical, organizational, or legal - especially but not limited to contractual in regards to the indicated attributes present in the descriptions.</span><span class="se">\n\n</span><span class="s2">The keypair used to sign Verifiable Credentials will be revoked where Gaia-X Association becomes aware of any inaccurate statements in regards to the claims which result in a non-compliance with the Trust Framework and policy rules defined in the Policy Rules and Labelling Document (PRLD)."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/gx-terms-and-cs.json#subject"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/gx-terms-and-cs.json"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The structure and content of the credential is slightly different but the process is the same as for the Participant Gaia-X Credential.
In short:</p>

<ol>
  <li>Sign the JSON using the <code class="language-plaintext highlighter-rouge">privkey.pem</code>.</li>
  <li>Extend the JSON by a “proof” section containing the JSON Web Signature (JWS).</li>
  <li>Publish the resulting Gaia-X Credential as JSON at <code class="language-plaintext highlighter-rouge">mydomain.com/.well-known/gx-terms-and-cs.json</code>.</li>
</ol>

<p>Once again, other Gaia-X Participants may now retrieve this signed credential and validate its signature using our DID reference and the resulting public key.</p>

<h3 id="step-6-building-the-verifiable-presentation-for-the-compliance-api">Step 6: Building the Verifiable Presentation for the Compliance API</h3>

<p>Here is a recap of the assets we created so far:</p>

<ol>
  <li>Our public/private key pair, the X.509 certificate and DID document.</li>
  <li>A Gaia-X Credential attesting our Legal Registration Number (LRN), signed by the Gaia-X Notarization Service.</li>
  <li>A self-signed Gaia-X Credential describing our identity as Participant, referencing our LRN credential.</li>
  <li>A self-signed Gaia-X Credential for the Gaia-X Terms &amp; Conditions we pledge to adhere to.</li>
</ol>

<p>Using this minimal set of credentials we can now build a Verifiable Presentation for ourselves and submit it to the <a href="https://compliance.lab.gaia-x.eu/v1-staging/docs">Gaia-X Compliance API</a>.</p>

<p>The process is pretty straightforward and only requires us to assemble all desired Gaia-X Credentials in a Verifiable Presentation structure:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VerifiablePresentation"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"verifiableCredential"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">LRN</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">Participant</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">Terms</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Conditions</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The JSON objects within the <code class="language-plaintext highlighter-rouge">verifiableCredential</code> list are the entire signed JSON structures (including the “proof” section) as individually created in the previous steps.
They are omitted and replaced by placeholders here for readability.</p>

<p>Please note that there is a mismatch between the Gaia-X official documentation and the implementation of the GXDCH Compliance Service for the Tagus release.
According to the <a href="https://gaia-x.gitlab.io/policy-rules-committee/compliance-document/Process/">Gaia-X specification</a>, the Compliance Service requires a <a href="https://www.w3.org/TR/vc-data-model/#dfn-verifiable-presentations">W3C Verifiable Presentation</a> as input.
A Verifiable Presentation is a set of Verifiable Credentials, whose authorship can be cryptographically verified, i.e., each Verifiable Presentation MUST contain at least one “proof” section.
In contrast to this requirement, the Gaia-X Compliance Service accepts Verifiable Presentations without a “proof” section, which is just a Presentation according to the <a href="https://www.w3.org/TR/vc-data-model/#presentations-0">W3C Verifiable Credentials Data Model v1.1</a>.
This mismatch was already <a href="https://gitlab.com/gaia-x/technical-committee/identity-credentials-and-access-management-working-group/icam/-/issues/72">reported</a> by the community.</p>

<p>We simply send the request body referenced above to <code class="language-plaintext highlighter-rouge">https://compliance.lab.gaia-x.eu/v1-staging/api/credential-offers</code> and as a response we receive yet another Gaia-X Credential, assumed that the Gaia-X Compliance Service can successfully validate the signature of each individual credential contained in the Verifiable Presentation.</p>

<p>This time, the received credential does not contain the whole input structure again, which would include the full JSON representation of all Gaia-X Credentials included in the Verifiable Presentation.
Instead, credentials are only referenced by their subject ID and a hash of their content as received by the Gaia-X Compliance Service:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:legalRegistrationNumber"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/gx-terms-and-cs.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:GaiaXTermsAndConditions"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/participant.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:LegalParticipant"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">...</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>(output truncated for readability)</p>

<p>This final Gaia-X Credential is the Gaia-X Compliance VC and attests the compliance of our Verifiable Presentation and its included credentials.
We can now share the Verifiable Presentation along with this Gaia-X Compliance VC to prove our Gaia-X compliance as a Gaia-X Legal Participant.</p>

<p>However, this Verifiable Presentation on its own is not very useful to describe any properties of the services we offer as a CSP since it only concerns our identity.
Therefore, we want to create another Verifiable Presentation next which focuses on another Gaia-X class: the <strong>Service Offering</strong>.
For this, we need to create a corresponding Gaia-X Credential which we can then combine with some of the existing ones into another Verifiable Presentation for submission to the Gaia-X Compliance API.</p>

<h3 id="step-7-gaia-x-credential-for-service-offering">Step 7: Gaia-X Credential for Service Offering</h3>

<p>First, we need to create the Gaia-X Credential for the Service Offering.
The <a href="https://docs.gaia-x.eu/policy-rules-committee/trust-framework/22.10/service/">Gaia-X Trust Framework</a> expects four mandatory attributes, which have to be attested by a Gaia-X Credential for Service Offerings:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">providedBy</code>: A resolvable link to the Participant Gaia-X Credential providing the service.</li>
  <li><code class="language-plaintext highlighter-rouge">termsAndConditions</code>: A resolvable link to the Terms and Conditions applying to that service.</li>
  <li><code class="language-plaintext highlighter-rouge">policy</code>: A list of policies expressed using a DSL (e.g., Rego or ODRL), inlcuding access control, throttling, usage, retention, etc.</li>
  <li><code class="language-plaintext highlighter-rouge">dataAccountExport</code>: A list of methods to export data from your user’s account out of the service.</li>
</ol>

<p>The attribute <code class="language-plaintext highlighter-rouge">providedBy</code> links to a Gaia-X Credential representing the CSP.
We already created it in step 4 as a Verifiable Credential for <code class="language-plaintext highlighter-rouge">LegalParticipant</code>.
To refer to this credential, the value of <code class="language-plaintext highlighter-rouge">providedBy.id</code> must be the id of the credential subject of the Gaia-X Credential for <code class="language-plaintext highlighter-rouge">LegalParticipant</code>.</p>

<p>Here is how the resulting Gaia-X Credential for a Service Offering could look like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://w3id.org/security/suites/jws-2020/v1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://registry.lab.gaia-x.eu/development/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VerifiableCredential"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/service-offering.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:web:mydomain.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuanceDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T00:00:00.000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:ServiceOffering"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/service-offering.json#subject"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"gx:providedBy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/participant.json#subject"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"gx:termsAndConditions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"gx:URL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/tandc/"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"gx:hash"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"gx:policy"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"default: allow intent"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"gx:dataAccountExport"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"gx:requestType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"API"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gx:accessType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"digital"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"gx:formatType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/plain"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note that the link between the Service Offering Credential and the Participant Credential is established through the reference of the credential subject identifier, not the credential identifier.
See the <a href="#current-limitations-when-linking-between-gaia-x-credentials">corresponding appendix section</a> for further details.
Furthermore, as the Gaia-X Compliance Service (at the time of writing) does not resolve URL references to other credentials, we cannot simply link to the credentials we created and published in the previous steps.
As a result, any referenced Gaia-X Credentials (e.g. the Participant Credential referenced by the Service Offering’s <code class="language-plaintext highlighter-rouge">gx:providedBy</code>) must be included in the Verifiable Presentation in the next step again.</p>

<h3 id="step-8-building-another-verifiable-presentation-including-the-service-offering">Step 8: Building another Verifiable Presentation including the Service Offering</h3>

<p>Using the Gaia-X Credentials for the Service Offering and the minimal set of credentials for the CSP, we can now build a Verifiable Presentation for our service and submit it to the <a href="https://compliance.lab.gaia-x.eu/v1-staging/docs">Gaia-X Compliance API</a>.</p>

<p>As we already performed the same procedure for our first Verifiable Presentation in step 6, this process is pretty straightforward.
We just have to add the Gaia-X Credential for our Service Offering to the Verifiable Presentation from step 6:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VerifiablePresentation"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"verifiableCredential"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">LRN</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">Participant</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">Terms</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Conditions</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">//</span><span class="w"> </span><span class="err">signed</span><span class="w"> </span><span class="err">Service</span><span class="w"> </span><span class="err">Offering</span><span class="w"> </span><span class="err">credential</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>After submitting this Verifiable Presentation to the Gaia-X Compliance API, we receive a Verifiable Credential which attests the compliance of our Service Offering with Gaia-X:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nl">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/lrn.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:legalRegistrationNumber"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/gx-terms-and-cs.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:GaiaXTermsAndConditions"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/participant.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:LegalParticipant"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:compliance"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://mydomain.com/.well-known/service-offering.json"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"gx:integrity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256-&lt;hash&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
            </span><span class="nl">"gx:type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gx:ServiceOffering"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">...</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>(output truncated for readability)</p>

<h4 id="note-about-credential-linking-and-verification-by-the-gxdch-compliance-service">Note about credential linking and verification by the GXDCH Compliance Service</h4>

<p>At this point you may start to wonder why the GXDCH Compliance Service is able to verify the compliance of our Service Offering, when the proof and issuer of the CSP’s Verifiable Credentials are effectively lost, as we pointed out at the end of step 7 (see also the <a href="#current-limitations-when-linking-between-gaia-x-credentials">corresponding appendix section</a>).
Upon further examination, the GXDCH Compliance Service does evaluate the proof of the enclosing CSP’s credential regardless, which can be tested by tampering with the proof.
You will receive a HTTP status code 409 (Conflict):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The signature of the document with ID ... cannot be validated, please check the document has not been tampered"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Conflict"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">409</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This can be ascribed to the fact that the Compliance Service expects all Gaia-X Credentials to be part of the same Verifiable Presentation.
The Compliance Service does not actually resolve any URL references for credentials.
Instead, identifiers act as keys for a local lookup within the same Verifiable Presentation.
The Compliance Service looks for a Gaia-X Credential whose credential subject’s <code class="language-plaintext highlighter-rouge">id</code> matches with a given key and traverses back to its issuer and proof.
This is only possible because the full credential (including proof and issuer) of the referenced subject is always part of the Verifiable Presentation due to the requirement imposed by the Compliance Service.</p>

<p>This behavior seems to be a workaround and stands in contrast with the Linked Data principles of <a href="https://www.w3.org/TR/json-ld11/">JSON-LD</a>, which usually build links based on resolvable URLs.
There is an ongoing discussion to clarify if and/or why this behaviour is intended, see <a href="https://gitlab.com/gaia-x/lab/compliance/gx-compliance/-/issues/78">this issue discussion at Gaia-X</a>.</p>

<h3 id="automated-gaia-x-credential-generation-for-scs-infrastructures">Automated Gaia-X Credential generation for SCS infrastructures</h3>

<p>The Sovereign Cloud Stack (SCS) project is building tools to automate the process of Gaia-X Credential generation for SCS infrastructures, making most of the manual steps unnecessary.
There are two SCS tools that can help you automate most of the manual processes described in this blog post:</p>

<ol>
  <li><a href="https://github.com/SovereignCloudStack/scs-did-creator/">scs-did-creator</a></li>
  <li><a href="https://github.com/SovereignCloudStack/gx-credential-generator">gx-credential-generator</a></li>
</ol>

<p>The <strong>scs-did-creator</strong> helps with creating a DID document based on the desired key pairs and basically covers step 2 of the instructions above.</p>

<p>The <strong>gx-credential-generator</strong> implements Gaia-X Credential generation for the CSP identity as well as OpenStack-related service offerings and covers steps 3 through 8.
For the service offering, it includes auto-discovery for SCS infrastructures using the OpenStack API.
An extension to also cover the Kubernetes layer of SCS infrastructures is planned for the future.</p>

<h2 id="summary">Summary</h2>

<p>In this blog post we introduced the basic concepts of Gaia-X Credentials and Verifiable Presentations used by participants of the Gaia-X Trust Framework.
We presented the requirements and basic steps for getting started with creating Gaia-X Credentials for our identity as a CSP as well as our offered services.
Based on this foundation, a Verifiable Presentation was constructed in a step-by-step fashion consisting of an example set of credentials for submission to the Gaia-X Compliance Service.
At each step we made sure to point out the crucial details of properly linking and providing the required identity assets in compliance to the Gaia-X framework.
We then submitted the Verifiable Presentation about our identity to the Gaia-X Compliance Service and received our first Gaia-X Compliance VC attesting its compliance.
To expand on this, in the final steps we created an additional Gaia-X Credential for the Service Offering class to represent our services and built another Verifiable Presentation based on it.</p>

<p>At the end we briefly presented tools developed by the SCS project to automate Gaia-X Credential generation for SCS infrastructures, which cover most of the manual steps described in this blog post.</p>

<p>The created Gaia-X Credentials can later be registered in the <a href="https://docs.gaia-x.eu/technical-committee/architecture-document/22.10/federation_service/#federated-catalogue">Federated Catalogues of Gaia-X</a> to make them discoverable for consumers within the Gaia-X ecosystem.</p>

<h1 id="appendix">Appendix</h1>

<h2 id="current-limitations-when-linking-between-gaia-x-credentials">Current limitations when linking between Gaia-X Credentials</h2>

<p>There is a notable quirk about how Gaia-X links Gaia-X Credentials to each other, which deviates from the W3C Verifiable Credential standard and needs some explanation.
According to the <a href="https://docs.gaia-x.eu/technical-committee/identity-credential-access-management/22.10/credential_format/#verifiable-credential">Gaia-X Credential Format</a>, each Gaia-X Credential MUST have a unique <code class="language-plaintext highlighter-rouge">id</code> element which SHOULD be a resolvable URL.
According to the <a href="https://www.w3.org/TR/vc-data-model/#identifiers">W3C Verifiable Credential Data Model 1.1</a> the <code class="language-plaintext highlighter-rouge">id</code> element acts as an identifier for credentials.
It seems obvious to use the credential’s identifier as value of <code class="language-plaintext highlighter-rouge">providedBy</code> attribute.</p>

<p>However, the Gaia-X Compliance Service expects the <code class="language-plaintext highlighter-rouge">id</code> value of the nested <strong>credential subject</strong> instead of the top-level <code class="language-plaintext highlighter-rouge">id</code> value of the <strong>Verifiable Credential</strong> itself.
Taking the Service Offering Credential as an example, the difference can be visualized like this:</p>

<figure class="figure mx-auto d-block" style="width:100%">
  <a href="/website/assets/images/blog/gx-credentials/gx-participant-so-relation-f78db8e84025d25148d38dd7fa37a3bab79f40795a6d6e2824055bde7393d3c02515d3c6c3c73f52c124b6f74212fb50f7431b92574fb7da4cc162945b234d99.png">
    <img class="figure-img w-100" src="/website/assets/images/blog/gx-credentials/gx-participant-so-relation-f78db8e84025d25148d38dd7fa37a3bab79f40795a6d6e2824055bde7393d3c02515d3c6c3c73f52c124b6f74212fb50f7431b92574fb7da4cc162945b234d99.png" />
  </a>
</figure>

<p>Credential subjects themselves have neither a digital signature nor an issuer.
Only the owning Verifiable Credential has these properties but is not reachable from the credential subject in the hierarchy when traversing the RDF graph, strictly speaking.
A verifier would not be able to properly validate authorship or recognize tampering of referenced claims, i.e., of a CSP in case of the <code class="language-plaintext highlighter-rouge">providedBy</code> of Service Offering Gaia-X Credentials.
This behaviour seems detrimental and was already requested to be clarified, see <a href="https://gitlab.com/gaia-x/lab/compliance/gx-compliance/-/issues/78">this issue discussion at Gaia-X</a>.</p>

<h2 id="python-code-for-signing-verifiable-credentials">Python code for signing Verifiable Credentials</h2>

<p>The following code snippet illustrates how to build a signed Verifiable Credential using the <code class="language-plaintext highlighter-rouge">jwcrypto</code> library and the assets introduced in this blog post.
The code is loosely based on <a href="https://gitlab.com/gaia-x/lab/workshops/gaia-x-101/-/blob/e0b01980eead64c0a20fec4643659b4c9d9f3331/utils.py">this example implementation from a Gaia-X workshop</a> that was published and licensed under the <a href="https://gitlab.com/gaia-x/lab/workshops/gaia-x-101/-/blob/e0b01980eead64c0a20fec4643659b4c9d9f3331/LICENSE">Eclipse Public License - v 2.0</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">from</span> <span class="n">jwcrypto</span> <span class="kn">import</span> <span class="n">jws</span><span class="p">,</span> <span class="n">jwk</span>
<span class="kn">from</span> <span class="n">jwcrypto.common</span> <span class="kn">import</span> <span class="n">json_encode</span>
<span class="kn">from</span> <span class="n">pyld</span> <span class="kn">import</span> <span class="n">jsonld</span>


<span class="k">def</span> <span class="nf">compact_token</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sh">"</span><span class="s">..</span><span class="sh">"</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">sign_credential</span><span class="p">(</span><span class="n">credential</span><span class="p">):</span>
    <span class="c1"># The private key used for signing
</span>    <span class="n">private_key</span> <span class="o">=</span> <span class="n">jwk</span><span class="p">.</span><span class="n">JWK</span><span class="p">.</span><span class="nf">from_pem</span><span class="p">(</span><span class="sh">"</span><span class="s">privkey.pem</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># DID reference to the did.json
</span>    <span class="n">verification_method</span> <span class="o">=</span> <span class="sh">"</span><span class="s">did:web:mydomain.com#JWK2020-RSA</span><span class="sh">"</span>
    <span class="c1"># URDNA normalize
</span>    <span class="n">normalized</span> <span class="o">=</span> <span class="n">jsonld</span><span class="p">.</span><span class="nf">normalize</span><span class="p">(</span>
        <span class="n">credential</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">algorithm</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">URDNA2015</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">format</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">application/n-quads</span><span class="sh">'</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># sha256 the RDF
</span>    <span class="n">normalized_hash</span> <span class="o">=</span> <span class="nf">sha256</span><span class="p">(</span><span class="n">normalized</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># Sign using JWS
</span>    <span class="n">jws_token</span> <span class="o">=</span> <span class="n">jws</span><span class="p">.</span><span class="nc">JWS</span><span class="p">(</span><span class="n">normalized_hash</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">())</span>
    <span class="n">jws_token</span><span class="p">.</span><span class="nf">add_signature</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="nf">json_encode</span><span class="p">(</span>
                                <span class="p">{</span><span class="sh">"</span><span class="s">alg</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">PS256</span><span class="sh">"</span><span class="p">,</span>
                                <span class="sh">"</span><span class="s">b64</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                <span class="sh">"</span><span class="s">crit</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">b64</span><span class="sh">"</span><span class="p">]}</span>
                            <span class="p">),</span>
                            <span class="nf">json_encode</span><span class="p">({</span><span class="sh">"</span><span class="s">kid</span><span class="sh">"</span><span class="p">:</span> <span class="n">private_key</span><span class="p">.</span><span class="nf">thumbprint</span><span class="p">()}))</span>
    <span class="n">signed</span> <span class="o">=</span> <span class="n">jws_token</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Add the "proof" section to the credential
</span>    <span class="n">credential</span><span class="p">[</span><span class="sh">'</span><span class="s">proof</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">JsonWebSignature2020</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">proofPurpose</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">assertionMethod</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">verificationMethod</span><span class="sh">"</span><span class="p">:</span> <span class="n">verification_method</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">jws</span><span class="sh">"</span><span class="p">:</span> <span class="nf">compact_token</span><span class="p">(</span><span class="n">signed</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">credential</span>
</code></pre></div></div>

<h2 id="python-code-for-verifying-signed-verifiable-credentials">Python code for verifying signed Verifiable Credentials</h2>

<p>The following code snippet illustrates how to validate the JSON Web Signature (JWS) of a given Verifiable Credential.
The code is loosely based on <a href="https://gitlab.com/gaia-x/lab/workshops/gaia-x-101/-/blob/e0b01980eead64c0a20fec4643659b4c9d9f3331/utils.py">this example implementation from a Gaia-X workshop</a> that was published and licensed under the <a href="https://gitlab.com/gaia-x/lab/workshops/gaia-x-101/-/blob/e0b01980eead64c0a20fec4643659b4c9d9f3331/LICENSE">Eclipse Public License - v 2.0</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">from</span> <span class="n">jwcrypto</span> <span class="kn">import</span> <span class="n">jwk</span><span class="p">,</span> <span class="n">jws</span>
<span class="kn">from</span> <span class="n">pyld</span> <span class="kn">import</span> <span class="n">jsonld</span>


<span class="k">def</span> <span class="nf">verify_credential</span><span class="p">(</span><span class="n">credential_json_str</span><span class="p">,</span> <span class="n">cert_url</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    credential_json_str : the signed Verifiable Credential as JSON string.

    cert_url : the URL to the signature verification certificate usually
    encoded as the x5u attribute of the issuer</span><span class="sh">'</span><span class="s">s did.json document.
    </span><span class="sh">"""</span>

    <span class="n">verifiable_credential</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">credential_json_str</span><span class="p">)</span>

    <span class="c1"># Retrieve the registry certificate which serves as the verification
</span>    <span class="c1"># public key (JWK) for the JWS later
</span>    <span class="n">reg_cert_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">cert_url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reg_cert_response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Unable to retrieve verification certificate </span><span class="sh">"</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">from: </span><span class="si">{</span><span class="n">cert_url</span><span class="si">}</span><span class="sh">"</span>
        <span class="p">)</span>
    <span class="n">verification_cert_pem</span> <span class="o">=</span> <span class="n">reg_cert_response</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">UTF-8</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">verification_key</span> <span class="o">=</span> <span class="n">jwk</span><span class="p">.</span><span class="n">JWK</span><span class="p">.</span><span class="nf">from_pem</span><span class="p">(</span><span class="n">verification_cert_pem</span><span class="p">)</span>

    <span class="c1"># The proof object is part of the credential response, however
</span>    <span class="c1"># it resembles JWS data applicable to the response without the
</span>    <span class="c1"># proof object. Hence, we need to strip the proof object from
</span>    <span class="c1"># the response.
</span>    <span class="n">proof</span> <span class="o">=</span> <span class="n">verifiable_credential</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="sh">"</span><span class="s">proof</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># The remaining structure is the actual credential data that
</span>    <span class="c1"># JWS was created for. The signature was applied to its
</span>    <span class="c1"># normalized and hashed form, which we need to recreate here
</span>    <span class="c1"># in order to verify the signature.
</span>    <span class="c1"># See: https://w3c.github.io/vc-data-integrity/#how-it-works
</span>    <span class="n">normalized_credential</span> <span class="o">=</span> <span class="n">jsonld</span><span class="p">.</span><span class="nf">normalize</span><span class="p">(</span>
        <span class="n">verifiable_credential</span><span class="p">,</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">algorithm</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">URDNA2015</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">format</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">application/n-quads</span><span class="sh">'</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">hashed_credential</span> <span class="o">=</span> <span class="nf">sha256</span><span class="p">(</span><span class="n">normalized_credential</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>

    <span class="c1"># Instantiate a JWS object based on the jws attribute of the
</span>    <span class="c1"># proof object, which contains a base64 representation of the JWS.
</span>    <span class="n">received_jws_token</span> <span class="o">=</span> <span class="n">jws</span><span class="p">.</span><span class="nc">JWS</span><span class="p">()</span>
    <span class="n">received_jws_token</span><span class="p">.</span><span class="nf">deserialize</span><span class="p">(</span><span class="n">proof</span><span class="p">[</span><span class="sh">"</span><span class="s">jws</span><span class="sh">"</span><span class="p">])</span>

    <span class="c1"># Finally, use the verification key (Gaia X registry public cert)
</span>    <span class="c1"># and the hashed credential (which is the JWS' detached payload)
</span>    <span class="c1"># in conjunction with the JWS token to verify the credential.
</span>    <span class="c1"># This method will throw an exception if verification fails.
</span>    <span class="n">received_jws_token</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">verification_key</span><span class="p">,</span>
        <span class="n">detached_payload</span><span class="o">=</span><span class="n">hashed_credential</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></div>





  </div>
  <!-- /.container -->
  <!-- Footer -->
<footer class="py-5 bg-dark">
  <div class="container text-light bg-dark">
    <div class="row">
      <div class="col-lg-5">
        <a href="#" class="footer-site-logo">
          <img alt="Sovereign Cloud Stack" class="img-fluid mb-2" src="/website/assets/images/SCS_short-1b31802be07ab137d2373f3cd2e268923d727ee1d19b6b577dff3b71610345de088c3b83c90f66897a21e52e84fa03c1ef4d1ca5193b8659b9c9535946aa0154.svg">
        </a>
        <p class="small my-1">Sovereign Cloud Stack, SCS and the logo are registered trademarks of the Open Source Business Alliance e.V. — Other trademarks are property of their respective owners.</p>
        <ul class="list-inline mt-2 mb-1">
          
          <li class="list-inline-item small me-sm-4 me-3">
            <i class="text-light fa fa-phone me-1"></i> <a class="text-light text-decoration-none" href="tel:+49-30-300149-3377" title="+49-30-300149-3377">+49-30-300149-3377</a>
          </li>
          
          <li class="list-inline-item small me-sm-4 me-3">
            <i class="text-light fa fa-envelope me-1"></i> <a class="text-light text-decoration-none" href="mailto:scs@osb-alliance.com" title="scs[at]osb-alliance[dot]com">scs[at]osb-alliance[dot]com</a>
          </li>
          
        </ul>
      </div>
      <div class="col-lg-7">
        <ul class="list-inline text-lg-end mt-1 mb-1">
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://social.osb-alliance.de/@SCS">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-mastodon fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://www.linkedin.com/company/sovereigncloudstack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-linkedin-square fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://www.youtube.com/@sovereigncloudstack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-youtube-square fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://github.com/SovereignCloudStack">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-github fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-matrix-org fa-lg fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="https://scs.sovereignit.de/mailman3/postorius/lists/announce.lists.scs.community/">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-bullhorn fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
          <li class="list-inline-item me-2">
            <span class="fa-stack fa-lg">
            <a target="_blank" href="/feed.xml">
              <i class="text-gray fa fa-square fa-stack-2x"></i>
              <i class="text-white fa fa-rss fa-stack-1x"></i>
            </a>
            </span>
          </li>
          
        </ul>
        <ul class="list-inline text-lg-end mt-2">
          
          <li class="list-inline-item me-2 ms-lg-2">
            <a class="text-light text-decoration-none" title="Imprint" href="/website/imprint/">Imprint</a>
          </li>
          
          <li class="list-inline-item me-2 ms-lg-2">
            <a class="text-light text-decoration-none" title="Data Protection Statement" href="/website/dataprotection/">Data Protection Statement</a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
  <!-- /.container -->
</footer>

</body>

</html>
